---
title: 從 IoT 資料擷取可操作見解
description: 使用 Azure 服務從 IoT 資料擷取見解。
author: ercenk
ms.author: ercenk
manager: gmarchet
ms.service: industry
ms.topic: article
ms.date: 09/26/2018
ms.openlocfilehash: 79f6829d80bea2cf05bc11b613476f64dad900ef
ms.sourcegitcommit: 76f2862adbec59311b5888e043a120f89dc862af
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/03/2018
ms.locfileid: "51654405"
---
# <a name="extracting-actionable-insights-from-iot-data"></a><span data-ttu-id="7e377-103">從 IoT 資料擷取可操作見解</span><span class="sxs-lookup"><span data-stu-id="7e377-103">Extracting actionable insights from IoT data</span></span>

<span data-ttu-id="7e377-104">如果您負責工廠的機器，應該已意識到物聯網 (IoT) 是改善流程和結果的下一步。</span><span class="sxs-lookup"><span data-stu-id="7e377-104">If you are responsible for the machines on a factory floor, you are already aware that the Internet of Things (IoT) is the next step in improving your processes and results.</span></span> <span data-ttu-id="7e377-105">第一步是在機器或工廠裝設感應器。</span><span class="sxs-lookup"><span data-stu-id="7e377-105">Having sensors on machines, or the factory floor, is the first step.</span></span> <span data-ttu-id="7e377-106">下一步是使用資料 - 這是本文件的物件。</span><span class="sxs-lookup"><span data-stu-id="7e377-106">The next step is to use the data—which is the object of this document.</span></span> <span data-ttu-id="7e377-107">本指南提供從 IoT 資料分析中擷取可操作見解所需元件的技術概觀。</span><span class="sxs-lookup"><span data-stu-id="7e377-107">This guide provides a technical overview of the components needed to extract actionable insights from IoT data analytics.</span></span>

<span data-ttu-id="7e377-108">IoT 分析解決方案旨在將來自一組裝置之未經處理的 IoT 資料，轉換為更適合分析的形式。</span><span class="sxs-lookup"><span data-stu-id="7e377-108">IoT analytics solutions are about transforming raw IoT data coming from a set of devices into a form that is better suited for analytics.</span></span> <span data-ttu-id="7e377-109">一旦資料處於可分析形式，即可實際執行分析。</span><span class="sxs-lookup"><span data-stu-id="7e377-109">Once the data is in an analyzable form we can actually perform analytics.</span></span> <span data-ttu-id="7e377-110">分析的一些範例包括：</span><span class="sxs-lookup"><span data-stu-id="7e377-110">Some examples of analytics include:</span></span>

- <span data-ttu-id="7e377-111">遙測資料的簡單視覺效果，例如，顯示溫度隨時間變化的橫條圖</span><span class="sxs-lookup"><span data-stu-id="7e377-111">simple visualizations of the telemetry data, for example, a bar chart showing temperatures over time</span></span>
- <span data-ttu-id="7e377-112">KPI 計算，例如，整體設備效率 (OEE)</span><span class="sxs-lookup"><span data-stu-id="7e377-112">calculation of KPIs, for example, Overall Equipment Effectiveness (OEE)</span></span>
- <span data-ttu-id="7e377-113">機器學習服務提供的預測性分析</span><span class="sxs-lookup"><span data-stu-id="7e377-113">predictive analytics powered by machine learning models</span></span>

<span data-ttu-id="7e377-114">接著，這些分析會提供動作參考資訊的見解。</span><span class="sxs-lookup"><span data-stu-id="7e377-114">These analytics, in turn, provide insights that inform actions.</span></span> <span data-ttu-id="7e377-115">動作範圍可從傳送簡單命令到機器、調整作業參數、在另一個軟體系統上執行操作，到實作整間公司的作業改善計畫。</span><span class="sxs-lookup"><span data-stu-id="7e377-115">Actions may range from sending a simple command to a machine, to tweaking operational parameters, to performing an action on another software system, to implementing company-wide operational improvement programs.</span></span>

<span data-ttu-id="7e377-116">下圖顯示工廠機器和最終結果之間發生的一系列動作，這是呈現「使用率」的儀表板，顯示圖表和標籤 "87.5%"。</span><span class="sxs-lookup"><span data-stu-id="7e377-116">The figure below shows a chain of actions that occur between a factory machine and the end result, which is a dashboard representation of “utilization,” showing a graph and the label “87.5%.”</span></span>

![工廠到儀表板。](assets/extracting-insights-from-iot/factory-to-dashboard.png)

<span data-ttu-id="7e377-118">為了加以說明，我們將使用簡單 KPI 的計算：機器使用率。</span><span class="sxs-lookup"><span data-stu-id="7e377-118">For the purposes of illustration, we will use the calculation of a simple KPI: machine utilization.</span></span> <span data-ttu-id="7e377-119">*機器使用率*是機器實際*生產*組件的時間百分比。</span><span class="sxs-lookup"><span data-stu-id="7e377-119">*Machine utilization* is the percentage of time the machine is actually *producing* parts.</span></span> <span data-ttu-id="7e377-120">例如，如果一個班次有 8 小時，而其中 7 小時是機器生產組件的時間，則該班次的機器使用率為 87.5% (7/8 x 100)。</span><span class="sxs-lookup"><span data-stu-id="7e377-120">For example, if there are 8 hours in a shift, and the machine is producing parts for 7 of those hours, then the machine utilization for that shift is 87.5% (7/8 x 100).</span></span>

## <a name="approach"></a><span data-ttu-id="7e377-121">方法</span><span class="sxs-lookup"><span data-stu-id="7e377-121">Approach</span></span>

<span data-ttu-id="7e377-122">IoT 應用程式有三個元件：**事項** (或裝置)，傳送用於產生**見解**的資料或事件，其用於產生**動作**以幫助改善業務或程序。</span><span class="sxs-lookup"><span data-stu-id="7e377-122">IoT applications have three components: **things** (or devices), sending data or events that are used to generate **insights**, which are used to generate **actions** to help improve a business or process.</span></span>

<span data-ttu-id="7e377-123">製造工廠 (事項) 中的設備會在運作時傳送各種類型的資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-123">The equipment in a manufacturing plant (things) sends various types of data as it operates.</span></span> <span data-ttu-id="7e377-124">例如，銑床機傳送進給率和溫度資料；這用於評估機器是否正在運作 (見解)，用於讓工廠以最有效率的方式運作 (動作)。</span><span class="sxs-lookup"><span data-stu-id="7e377-124">An example is a milling machine sending feed rate and temperature data; this is used to evaluate whether the machine is running or not—an insight—which is used to optimize the plant—an action.</span></span> <span data-ttu-id="7e377-125">我們將逐步執行擷取資料、在儀表板中對其進行視覺化、擷取新見解，以及採取進一步的動作。</span><span class="sxs-lookup"><span data-stu-id="7e377-125">We will go through the steps to extract the data, visualize it in a dashboard, extract new insights, and take further actions.</span></span>
<span data-ttu-id="7e377-126">![事項到見解到動作。](assets/extracting-insights-from-iot/things-insights-actions.png)</span><span class="sxs-lookup"><span data-stu-id="7e377-126">![Things to Insights to Actions.](assets/extracting-insights-from-iot/things-insights-actions.png)</span></span>

<span data-ttu-id="7e377-127">Microsoft 已針對 IoT 應用程式發佈高階參考架構，其逐步解說各種子系統，以及這些子系統的推薦方法。</span><span class="sxs-lookup"><span data-stu-id="7e377-127">Microsoft has published a high level reference architecture for IoT applications that walks through the various subsystems and the recommended approaches for those subsystems.</span></span>
<span data-ttu-id="7e377-128">IoT 應用程式是由下列的子系統所組成：</span><span class="sxs-lookup"><span data-stu-id="7e377-128">An IoT application consists of the following subsystems:</span></span>

1. <span data-ttu-id="7e377-129">設備或內部部署邊緣閘道，它們是一種特定類型的裝置，可安全地向雲端註冊訊息來源 (裝置)。</span><span class="sxs-lookup"><span data-stu-id="7e377-129">Devices, or on-premises edge gateways, which are a specific kind of device that can securely register message sources (devices) with the cloud.</span></span> <span data-ttu-id="7e377-130">邊緣閘道也可以將訊息從本機通訊協定轉換為另一種格式 (例如 JSON)。</span><span class="sxs-lookup"><span data-stu-id="7e377-130">The edge gateway may also transform messages from a native protocol to another format (such as JSON).</span></span>
2. <span data-ttu-id="7e377-131">雲端閘道服務或中樞 (例如 [Azure IoT 中樞](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)或 [Azure 事件中樞](https://docs.microsoft.com/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk))，可安全地擷取資料，並提供裝置管理功能。</span><span class="sxs-lookup"><span data-stu-id="7e377-131">A cloud gateway service, or hub (such as [Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk) or [Azure Event Hubs](https://docs.microsoft.com/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk)), to securely ingest data and provide device management capabilities.</span></span> 
3. <span data-ttu-id="7e377-132">取用串流資料的串流處理器。</span><span class="sxs-lookup"><span data-stu-id="7e377-132">Stream processors that consume streaming data.</span></span> <span data-ttu-id="7e377-133">處理器也可以與商務程序整合，並將資料放入儲存體。</span><span class="sxs-lookup"><span data-stu-id="7e377-133">The processors may also integrate with business processes and place the data into storage.</span></span>
4. <span data-ttu-id="7e377-134">使用者介面 (儀表板的形式) 可視覺化 IoT 資料，並使裝置管理更容易。</span><span class="sxs-lookup"><span data-stu-id="7e377-134">A user interface, in the form of a dashboard, to visualize IoT data and facilitate device management.</span></span>

![解決方案的架構。](assets/extracting-insights-from-iot/architecture.png)

<span data-ttu-id="7e377-136">在本文中，我們會著重在擷取見解的程序。</span><span class="sxs-lookup"><span data-stu-id="7e377-136">In this article, we focus on the process of extracting insights.</span></span> <span data-ttu-id="7e377-137">以下是主要步驟：</span><span class="sxs-lookup"><span data-stu-id="7e377-137">These are the major steps:</span></span>

1. <span data-ttu-id="7e377-138">存取資料，並將其處理為資料流。</span><span class="sxs-lookup"><span data-stu-id="7e377-138">Access the data and process it into a data stream.</span></span>
2. <span data-ttu-id="7e377-139">處理並儲存資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-139">Process and store the data.</span></span>
3. <span data-ttu-id="7e377-140">視覺化或呈現資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-140">Visualize or present the data.</span></span> 

<span data-ttu-id="7e377-141">下方圖表顯示資料流、從資料來源、到轉換、擷取、處理和儲存，再到呈現，以及最後動作。</span><span class="sxs-lookup"><span data-stu-id="7e377-141">The figure below is a diagram that shows the flow of data, from data source, to convert, to ingestion, to process and store, to presentation, and finally action.</span></span>

![資料流：來源到擷取到呈現，再到動作。](assets/extracting-insights-from-iot/data-flow.png)

## <a name="converting-the-data-to-a-stream"></a><span data-ttu-id="7e377-143">將資料轉換至串流</span><span class="sxs-lookup"><span data-stu-id="7e377-143">Converting the data to a stream</span></span>

<span data-ttu-id="7e377-144">IoT 資料是時間序列資料：「事項」中的值會在一段時間內變得更有意義。</span><span class="sxs-lookup"><span data-stu-id="7e377-144">IoT data is time-series data: values from “things” that can be more meaningful over a time span.</span></span> <span data-ttu-id="7e377-145">工廠設備隨著時間運作，並在此期間發生事件。</span><span class="sxs-lookup"><span data-stu-id="7e377-145">Equipment on a plant floor operates through time, and events occur during that time.</span></span> <span data-ttu-id="7e377-146">如果廠房資料未傳送至資料擷取服務，例如 [Azure IoT 中樞](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)，我們必須定期輪詢其存放區的資料 - 例如，製造執行系統 (MES)，或 HTTP 端點)，並將資料傳送至擷取服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-146">If the data on the plant floor is not sent to a data ingestion service, such as [Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk), we must poll for the data periodically from its store—for  example, a Manufacturing Execution System (MES), or an HTTP endpoint), and send the data to an ingestion service.</span></span>  
<span data-ttu-id="7e377-147">若要將資料轉換至串流，我們通常會：</span><span class="sxs-lookup"><span data-stu-id="7e377-147">To convert data to a stream, we usually:</span></span>

1. <span data-ttu-id="7e377-148">存取資料來源。</span><span class="sxs-lookup"><span data-stu-id="7e377-148">Access the data source.</span></span>
2. <span data-ttu-id="7e377-149">轉換及擴充資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-149">Transform and enrich the data.</span></span>
3. <span data-ttu-id="7e377-150">將資料貼到可擷取串流資料的端點。</span><span class="sxs-lookup"><span data-stu-id="7e377-150">Post the data to an endpoint that can ingest streaming data.</span></span>

<span data-ttu-id="7e377-151">我們在此不詳述資料來源的存取權，因為存取權取決於資料所在位置，而且變數太多。</span><span class="sxs-lookup"><span data-stu-id="7e377-151">We don’t cover the access to the data source in detail here, since access depends on where the data resides,  and the variations are too numerous.</span></span>

## <a name="transforming-and-enriching-the-data"></a><span data-ttu-id="7e377-152">轉換及擴充資料</span><span class="sxs-lookup"><span data-stu-id="7e377-152">Transforming and enriching the data</span></span>

<span data-ttu-id="7e377-153">未經處理資料通常必須進行轉換作業，將其標準化，並備妥供擷取使用。</span><span class="sxs-lookup"><span data-stu-id="7e377-153">Raw data must usually undergo transformation operations to standardize it and prepare it for ingestion.</span></span>  <span data-ttu-id="7e377-154">特定的轉換取決於使用的分析類型而不同。</span><span class="sxs-lookup"><span data-stu-id="7e377-154">The specific transformations will vary depending on the type of analytics used.</span></span>  <span data-ttu-id="7e377-155">資料轉換的一些常見範例是時間序列資料，其中可能缺少測量，並且需要輸入測量，或者需要合理化不同機器的時幅。</span><span class="sxs-lookup"><span data-stu-id="7e377-155">Some common examples of data transformations are time-series data where measurements may be missing and need to be inputted, or where the time scales across different machines needs to be rationalized.</span></span>  <span data-ttu-id="7e377-156">我們希望有加上時間戳記的資料記錄 (如果來源包含時間戳記) 和成對的名稱和數值。</span><span class="sxs-lookup"><span data-stu-id="7e377-156">We would like to have data records that are timestamped (if the source contains it) and in name-value pairs.</span></span> <span data-ttu-id="7e377-157">通常，資料會有階層式格式，且必須轉換成單層式結構。</span><span class="sxs-lookup"><span data-stu-id="7e377-157">Commonly, the data comes in a hierarchical format, and must be transformed into a flat structure.</span></span>

<span data-ttu-id="7e377-158">下圖顯示具有不規則設定檔的階層式資料結構，轉換成標準化的資料行和資料列格式 (區塊)。</span><span class="sxs-lookup"><span data-stu-id="7e377-158">The figure below shows a hierarchical data structure with a jagged profile, converted to a standardized column and row format (a block).</span></span>

![資料圖形從階層式到單層式。](assets/extracting-insights-from-iot/hierarchy-to-flat.png)

<span data-ttu-id="7e377-160">通常，無法從網際網路存取資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-160">Usually, the data is not accessible from the internet.</span></span> <span data-ttu-id="7e377-161">常見的模式是使用邊緣閘道，將資料從工廠推送到擷取點。</span><span class="sxs-lookup"><span data-stu-id="7e377-161">A common pattern is to use an edge gateway to push data from the plant floor to the ingestion point.</span></span> <span data-ttu-id="7e377-162">[Azure IoT Edge](https://docs.microsoft.com/azure/iot-edge?WT.mc_id=iotinsightssoln-docs-ercenk) 是建置在 IoT 中樞之外的服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-162">[Azure IoT Edge](https://docs.microsoft.com/azure/iot-edge?WT.mc_id=iotinsightssoln-docs-ercenk) is a service that builds on top of IoT Hub.</span></span> <span data-ttu-id="7e377-163">IoT Edge 裝置作為閘道有三種[模式](https://docs.microsoft.com/azure/iot-edge/iot-edge-as-gateway?WT.mc_id=iotinsightssoln-docs-ercenk)：透明閘道、通訊協定轉譯，以及身分識別轉譯。</span><span class="sxs-lookup"><span data-stu-id="7e377-163">An IoT Edge device can act as a gateway to cover three [patterns](https://docs.microsoft.com/azure/iot-edge/iot-edge-as-gateway?WT.mc_id=iotinsightssoln-docs-ercenk): transparent gateway, protocol translation, and identity translation.</span></span>

<span data-ttu-id="7e377-164">如果資料在外部可用，並且可從網際網路存取，則可以使用多個 Azure 服務以存取、轉換和擴充資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-164">If the data is available externally and is accessible from internet, several Azure services can be used to access, transform, and enrich the data.</span></span> <span data-ttu-id="7e377-165">這些選項包括：</span><span class="sxs-lookup"><span data-stu-id="7e377-165">Among those options are:</span></span>

- <span data-ttu-id="7e377-166">部署在各種 Azure 計算服務中的自訂程式碼，例如 [App Service](https://docs.microsoft.com/azure/app-service/?WT.mc_id=iotinsightssoln-docs-ercenk)、[Azure Kubernetes Service](https://docs.microsoft.com/azure/aks/?WT.mc_id=iotinsightssoln-docs-ercenk) (AKS)、[Container Instances](https://docs.microsoft.com/azure/container-instances/?WT.mc_id=iotinsightssoln-docs-ercenk)，或 [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-166">Custom code deployed in various Azure compute services, such as [App Service](https://docs.microsoft.com/azure/app-service/?WT.mc_id=iotinsightssoln-docs-ercenk),  [Azure Kubernetes Service](https://docs.microsoft.com/azure/aks/?WT.mc_id=iotinsightssoln-docs-ercenk) (AKS), [Container Instances](https://docs.microsoft.com/azure/container-instances/?WT.mc_id=iotinsightssoln-docs-ercenk), or [Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>
-   [<span data-ttu-id="7e377-167">Azure Logic Apps</span><span class="sxs-lookup"><span data-stu-id="7e377-167">Azure Logic Apps</span></span>](https://docs.microsoft.com/azure/logic-apps/?WT.mc_id=iotinsightssoln-docs-ercenk)
-   [<span data-ttu-id="7e377-168">Azure Data Factory 活動</span><span class="sxs-lookup"><span data-stu-id="7e377-168">Azure Data Factory Activities</span></span>](https://docs.microsoft.com/azure/data-factory/?WT.mc_id=iotinsightssoln-docs-ercenk)
-   [<span data-ttu-id="7e377-169">Azure Functions</span><span class="sxs-lookup"><span data-stu-id="7e377-169">Azure Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/functions-overview?WT.mc_id=iotinsightssoln-docs-ercenk)
-   [<span data-ttu-id="7e377-170">BizTalk 服務</span><span class="sxs-lookup"><span data-stu-id="7e377-170">BizTalk Services</span></span>](https://azure.microsoft.com/services/biztalk-services/)

<span data-ttu-id="7e377-171">上述每項服務都有各自的優點和成本，取決於具體情況而定。</span><span class="sxs-lookup"><span data-stu-id="7e377-171">Each of the services above have their own benefits and costs, depending on the scenario.</span></span> <span data-ttu-id="7e377-172">例如，Logic Apps 提供[轉換 XML 文件](https://docs.microsoft.com/azure/logic-apps/logic-apps-enterprise-integration-transform?WT.mc_id=iotinsightssoln-docs-ercenk)的方法。</span><span class="sxs-lookup"><span data-stu-id="7e377-172">For example, Logic Apps provide a means for [transforming XML documents](https://docs.microsoft.com/azure/logic-apps/logic-apps-enterprise-integration-transform?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-173">但是，資料可能是過於複雜的 XML 文件，因此，開發一個大型 XSLT 指令碼以轉換資料可能不切實際。</span><span class="sxs-lookup"><span data-stu-id="7e377-173">However, the data can be an overly complex XML document, so it may not be practical to develop a large XSLT script to transform the data.</span></span> <span data-ttu-id="7e377-174">在這種情況下，可以使用來自不同 Azure 服務的多個微服務，來開發混合式解決方案。</span><span class="sxs-lookup"><span data-stu-id="7e377-174">In this case, one might develop a hybrid solution using multiple microservices from different Azure services.</span></span> <span data-ttu-id="7e377-175">例如，在 Azure Logic Apps 中實作的微服務可以輪詢 HTTP 端點、暫時儲存未經處理的結果，並通知另一個微服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-175">For example, a microservice, implemented in Azure Logic Apps, can poll an HTTP endpoint, store the raw result temporarily, and notify another microservice.</span></span> <span data-ttu-id="7e377-176">另一個轉換訊息的微服務可自訂裝載在 [Azure Functions 主機](https://github.com/Azure/azure-functions-host)上的程式碼。</span><span class="sxs-lookup"><span data-stu-id="7e377-176">The other microservice—which transforms the message—can be custom code hosted on [Azure Functions Host](https://github.com/Azure/azure-functions-host).</span></span>  

![Https 會輪詢資料，並透過函式處理。](assets/extracting-insights-from-iot/poll-logic-process.png)

<span data-ttu-id="7e377-178">或者，您可以選擇由 Azure Data Factory 協調的工作流程，其中一系列活動會執行轉換。</span><span class="sxs-lookup"><span data-stu-id="7e377-178">Alternatively, you may opt for a workflow orchestrated by Azure Data Factory where a sequence of activities performs the transformations.</span></span> <span data-ttu-id="7e377-179">如需可用活動類型的詳細資料，請參閱 [Azure Data Factory 中的管線與活動](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities)。</span><span class="sxs-lookup"><span data-stu-id="7e377-179">For more details on the type of activities available, see [Pipelines and activities in Azure Data Factory](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities).</span></span>
<span data-ttu-id="7e377-180">訊息可以在接收時加上時間戳記，或者可以包含時間戳記，以便我們重建多個測量值的時間序列。</span><span class="sxs-lookup"><span data-stu-id="7e377-180">The messages can be timestamped at reception, or they may contain a timestamp to let us reconstruct the time series of several values measured.</span></span> <span data-ttu-id="7e377-181">因此，可忽略的擷取延遲和高輸送量是保證資訊完整性和最終回應時效性的基礎。</span><span class="sxs-lookup"><span data-stu-id="7e377-181">Hence, negligible ingestion latency and high throughput are fundamental to guarantee the integrity of information and timeliness of eventual responses.</span></span> <span data-ttu-id="7e377-182">若要將延遲降至最低，我們會將時間戳記標準化為盡可能接近工廠。</span><span class="sxs-lookup"><span data-stu-id="7e377-182">To minimize the latency, we normalize the time stamps as close as possible to the plant.</span></span>

## <a name="ingesting-the-data-stream"></a><span data-ttu-id="7e377-183">擷取資料流</span><span class="sxs-lookup"><span data-stu-id="7e377-183">Ingesting the data stream</span></span>

<span data-ttu-id="7e377-184">若要以串流分析資料，我們可以根據時間範圍，對資料進行查詢，以識別模式和關聯性。</span><span class="sxs-lookup"><span data-stu-id="7e377-184">To analyze the data as a stream, we can do queries on the data based on time windows to identify patterns and relationships.</span></span> <span data-ttu-id="7e377-185">Azure 平台上有各種服務，可利用高輸送量擷取資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-185">There are various services on the Azure platform that can ingest data at high throughput.</span></span>
<span data-ttu-id="7e377-186">在以下服務之間進行選擇，取決於專案的需求，例如裝置管理、通訊協定支援、延展性、團隊對程式設計模型的偏好等。例如，團隊可能會先前經驗而優先使用 Kafka，或者需要針對解決方案擁有 Kafka 訊息代理程式。</span><span class="sxs-lookup"><span data-stu-id="7e377-186">Choosing between the services below depends on the needs of the project, such as device management, protocol support, scalability, team’s preference of programming model etc. For example, team may have a preference to use Kafka because of their experience, or the need to have a Kafka broker for the solution.</span></span> <span data-ttu-id="7e377-187">或者，另一種情況是，專案可能需要資料擷取系統，以利用 [IoT 中樞裝置佈建服務的 TPM 金鑰證明](https://docs.microsoft.com/azure/iot-dps/?WT.mc_id=iotinsightssoln-docs-ercenk)來保護裝置對擷取點的存取權。</span><span class="sxs-lookup"><span data-stu-id="7e377-187">Or, for another case, the project may need the data ingestion system to take advantage of [IoT Hub Device Provisioning Service’s TPM Key Attestation](https://docs.microsoft.com/azure/iot-dps/?WT.mc_id=iotinsightssoln-docs-ercenk) to secure the access of the devices to the ingestion point.</span></span>

-   <span data-ttu-id="7e377-188">[Azure IoT 中樞](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)是 IoT 應用程式和裝置之間的雙向通訊中樞。</span><span class="sxs-lookup"><span data-stu-id="7e377-188">[Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk) is a bi-directional communication hub between IoT applications and the devices.</span></span> <span data-ttu-id="7e377-189">它是一種可擴充的服務，藉由提供安全通訊、訊息路由、與其他 Azure 服務的整合，以及用於控制和設定裝置的管理功能，實現全功能的 IoT 解決方案。</span><span class="sxs-lookup"><span data-stu-id="7e377-189">It is a scalable service that enables full-featured IoT solutions by providing secure communications, message routing, integration with other Azure services, and management features to control and configure the devices.</span></span>

-   <span data-ttu-id="7e377-190">[Azure 事件中樞](https://docs.microsoft.com/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk)是大規模的僅擷取服務，以極高的輸送率從並行來源收集遙測資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-190">[Azure Event Hubs](https://docs.microsoft.com/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk) is a high-scale ingestion-only service for collecting telemetry data from concurrent sources at exceedingly high throughput rates.</span></span>
-   <span data-ttu-id="7e377-191">[HDInsight 上的 Apache Kafka](https://docs.microsoft.com/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 是裝載 [Apache Kafka](https://kafka.apache.org/) 的受控服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-191">[Apache Kafka on HDInsight](https://docs.microsoft.com/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) is a managed service that hosts [Apache Kafka](https://kafka.apache.org/).</span></span> <span data-ttu-id="7e377-192">Apache Kafka 是開放原始碼分散式串流平台，其同時提供訊息代理程式功能。</span><span class="sxs-lookup"><span data-stu-id="7e377-192">Apache Kafka is an open-source distributed streaming platform that also provides message broker functionality.</span></span> <span data-ttu-id="7e377-193">託管服務的 Kafka 運作時間服務等級協定 (SLA) 為 99.9%。</span><span class="sxs-lookup"><span data-stu-id="7e377-193">The hosted service has a Service Level Agreement (SLA) of 99.9% on Kafka uptime.</span></span>

## <a name="processing-and-storing-the-data"></a><span data-ttu-id="7e377-194">處理並儲存資料</span><span class="sxs-lookup"><span data-stu-id="7e377-194">Processing and storing the data</span></span>

<span data-ttu-id="7e377-195">IoT 應用程式帶來挑戰，因為它們是事件驅動的系統，同時需要保留歷史資料，並在該資料上運作。</span><span class="sxs-lookup"><span data-stu-id="7e377-195">The IoT applications introduce challenges, as they are event-driven systems, that also need to keep and operate on historical data.</span></span> <span data-ttu-id="7e377-196">傳入資料是附加的資料類型，而且可能會變大。</span><span class="sxs-lookup"><span data-stu-id="7e377-196">The incoming data is an append type of data and can potentially grow large.</span></span> <span data-ttu-id="7e377-197">需要將資料保留更長時間，主要是基於以下原因：封存、批次分析，以及建置機器學習 (ML) 模型。</span><span class="sxs-lookup"><span data-stu-id="7e377-197">There is a need to keep data for longer periods, primarily for these reasons: archive, batch analytics, and to build machine learning (ML) models.</span></span> <span data-ttu-id="7e377-198">相反地，如果值超過或低於閾值，事件資料流對於近乎即時地分析以偵測異常、識別累積時間範圍上的模式，或觸發警報，是至關重要的。</span><span class="sxs-lookup"><span data-stu-id="7e377-198">On the other hand, the event stream is crucial for analyzing in near real-time to detect anomalies, recognize patterns over rolling time windows, or triggering alerts, if values go over or below a threshold.</span></span>
<span data-ttu-id="7e377-199">Microsoft 的 Azure IoT 參考架構為使用 Lambda 架構 之 IoT 解決方案的裝置到雲端訊息和事件，提供建議的資料流程。</span><span class="sxs-lookup"><span data-stu-id="7e377-199">Microsoft’s Azure IoT Reference Architecture presents a recommended data flow for device to cloud messages and events in an IoT solution using Lambda architecture.</span></span> <span data-ttu-id="7e377-200">Lambda 架構可以分析近乎即時的串流資料，以及封存資料，使其成為處理傳入資料的最佳選擇。</span><span class="sxs-lookup"><span data-stu-id="7e377-200">The Lambda architecture enables the analysis of both near real-time, streaming data, as well as archived data, which makes it the best option for processing of the incoming data.</span></span>

## <a name="lambda-architecture"></a><span data-ttu-id="7e377-201">Lambda 架構</span><span class="sxs-lookup"><span data-stu-id="7e377-201">Lambda architecture</span></span>

<span data-ttu-id="7e377-202">Lambda 架構會藉由建立兩個資料流程路徑，來解決此問題。</span><span class="sxs-lookup"><span data-stu-id="7e377-202">The Lambda architecture addresses this problem by creating two paths for data flow.</span></span> <span data-ttu-id="7e377-203">進入系統的所有資料會經過這兩個路徑：</span><span class="sxs-lookup"><span data-stu-id="7e377-203">All data coming into the system goes through these two paths:</span></span>

-   <span data-ttu-id="7e377-204">批次層 (非經常性路徑) 會以原始格式儲存所有傳入資料，並對資料執行批次處理。</span><span class="sxs-lookup"><span data-stu-id="7e377-204">A batch layer (cold path) stores all the incoming data in its raw form and performs batch processing on the data.</span></span> <span data-ttu-id="7e377-205">此處理的結果會儲存為批次檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-205">The result of this processing is stored as a batch view.</span></span> <span data-ttu-id="7e377-206">它是執行複雜分析的緩慢處理管線，例如，來自多個來源以及更長時間內 (數小時，數天或更長時間) 的組合資料，並產生新的資訊，例如報告、機器學習模型等。</span><span class="sxs-lookup"><span data-stu-id="7e377-206">It is a slow processing pipeline executing complex analysis, for example combining data from multiple sources and over a longer period (hours, days, or longer), and generating new information such as reports, machine learning models, etcetera.</span></span>
-   <span data-ttu-id="7e377-207">速度層 (經常性路徑) 會即時分析資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-207">A speed layer (warm path) analyzes data in real time.</span></span> <span data-ttu-id="7e377-208">這一層的設計目的是要犧牲精確度來實現低延遲。</span><span class="sxs-lookup"><span data-stu-id="7e377-208">This layer is designed for low latency, at the expense of accuracy.</span></span> <span data-ttu-id="7e377-209">它是更快的處理管線，可以封存和顯示傳入訊息，並分析這些記錄，產生短期的重要資訊和警示等動作。</span><span class="sxs-lookup"><span data-stu-id="7e377-209">It is a faster processing pipeline that archives and displays incoming messages, and analyzes these records generating short term critical information and actions such as alarms.</span></span>
-   <span data-ttu-id="7e377-210">批次層會饋送至「服務層」，其可回應查詢。</span><span class="sxs-lookup"><span data-stu-id="7e377-210">The batch layer feeds into a “serving layer,” which responds to queries.</span></span> <span data-ttu-id="7e377-211">批次層會為批次檢視編制索引，以便能有效率地查詢。</span><span class="sxs-lookup"><span data-stu-id="7e377-211">The batch layer indexes the batch view for efficient querying.</span></span> <span data-ttu-id="7e377-212">速度層會根據最新的資料，使用累加式更新來更新服務層。</span><span class="sxs-lookup"><span data-stu-id="7e377-212">The speed layer updates the serving layer with incremental updates based on the most recent data.</span></span>

<span data-ttu-id="7e377-213">下圖顯示代表轉換階段的五個區塊。</span><span class="sxs-lookup"><span data-stu-id="7e377-213">The following image shows five blocks that represent stages of transformation.</span></span> <span data-ttu-id="7e377-214">第一個區塊是資料流，其並行饋送速度層和批次層。</span><span class="sxs-lookup"><span data-stu-id="7e377-214">The first block is the data stream, which feeds both the speed layer and batch layer in parallel.</span></span> <span data-ttu-id="7e377-215">這兩個層級會饋送服務層，速度層和服務層都會饋送分析用戶端。</span><span class="sxs-lookup"><span data-stu-id="7e377-215">Both layers feed the serving layer, The speed layer and the serving layer both feed the analytics client.</span></span>

<span data-ttu-id="7e377-216">![Lambda 架構圖解。] (assets/extracting-insights-from-iot/lambda-schematic.png)</span><span class="sxs-lookup"><span data-stu-id="7e377-216">![Lambda architecture schematic.] (assets/extracting-insights-from-iot/lambda-schematic.png)</span></span>

 <span data-ttu-id="7e377-217">Azure 平台提供各種服務，可用於實作架構。</span><span class="sxs-lookup"><span data-stu-id="7e377-217">Azure platform provides various services that can be used for implementing the architecture.</span></span> <span data-ttu-id="7e377-218">下圖顯示如何對應這些服務，以進行實作。</span><span class="sxs-lookup"><span data-stu-id="7e377-218">The following diagram shows how those services can be mapped to implement it.</span></span> <span data-ttu-id="7e377-219">該圖顯示轉換的五個階段，每個階段都包含相關的 Azure 技術。</span><span class="sxs-lookup"><span data-stu-id="7e377-219">The figure shows the five stages of transformation, with each stage containing relevant Azure technologies.</span></span> <span data-ttu-id="7e377-220">深色方塊代表執行這些工作之多個選項的可用性。</span><span class="sxs-lookup"><span data-stu-id="7e377-220">The darker colored boxes represent the availability of multiple options to perform those tasks.</span></span>

![Lambda 架構。](assets/extracting-insights-from-iot/lambda-architecture-all.png)

<span data-ttu-id="7e377-222">上一節「擷取資料流」中，介紹速度層上資料擷取服務的選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-222">The options for the data ingestion service on the speed layer are covered in the previous section, “Ingesting the data stream.”</span></span>

<span data-ttu-id="7e377-223">[HDInsight 上的 Apache Kafka](https://docs.microsoft.com/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 可以是針對資料擷取服務和串流處理實作資料流的服務選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-223">[Apache Kafka on HDInsight](https://docs.microsoft.com/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) can be a service option to implement the data stream both for the data ingestion service and the stream processing.</span></span>

<span data-ttu-id="7e377-224">如果您使用事件中樞進行資料擷取服務，請使用 [Azure 串流分析](https://docs.microsoft.com/azure/stream-analytics?WT.mc_id=iotinsightssoln-docs-ercenk) (ASA)。</span><span class="sxs-lookup"><span data-stu-id="7e377-224">Use [Azure Stream Analytics](https://docs.microsoft.com/azure/stream-analytics?WT.mc_id=iotinsightssoln-docs-ercenk) (ASA) if you are using Event Hubs for the data ingestion service.</span></span> <span data-ttu-id="7e377-225">Azure 串流分析是事件處理引擎，可讓您檢查來自裝置的大量資料流。</span><span class="sxs-lookup"><span data-stu-id="7e377-225">Azure Stream Analytics is an event-processing engine that allows you to examine high volumes of data streaming from devices.</span></span> <span data-ttu-id="7e377-226">傳入的資料可能來自裝置、感應器、網站、社交媒體摘要和應用程式等。</span><span class="sxs-lookup"><span data-stu-id="7e377-226">Incoming data can originate from devices, sensors, web sites, social media feeds, applications, and more.</span></span> <span data-ttu-id="7e377-227">它也支援從資料流擷取資訊，識別模式和關聯性。</span><span class="sxs-lookup"><span data-stu-id="7e377-227">It also supports extracting information from data streams, identifying patterns, and relationships.</span></span>

<span data-ttu-id="7e377-228">要進行串流分析查詢必須先有串流資料的來源，這包括了擷取於 Azure 事件中樞或Azure IoT 中樞的資料，以及來自 Azure Blob 儲存體等資料存放區的資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-228">Stream Analytics queries start with a source of streaming data that is ingested into Azure Event Hub, Azure IoT Hub or from a data store like Azure Blob Storage.</span></span> <span data-ttu-id="7e377-229">若要檢查資料流，請建立串流分析作業，以指定串流資料的輸入來源。</span><span class="sxs-lookup"><span data-stu-id="7e377-229">To examine a stream, create a Stream Analytics job that specifies the input source that streams data.</span></span> <span data-ttu-id="7e377-230">此作業也會指定轉換查詢，以定義如何尋找資料、模式或關聯性。</span><span class="sxs-lookup"><span data-stu-id="7e377-230">The job also specifies a transformation query that defines how to look for data, patterns, or relationships.</span></span> <span data-ttu-id="7e377-231">轉換查詢會利用類似 SQL 的查詢語言，以便篩選、排序、彙總和聯結一段時間內的串流資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-231">The transformation query leverages a SQL-like query language that is used to filter, sort, aggregate, and join streaming data over a period of time.</span></span>

## <a name="warm-path"></a><span data-ttu-id="7e377-232">經常性路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-232">Warm Path</span></span>

<span data-ttu-id="7e377-233">此文件的範例案例是機器使用率 KPI (在指南的開頭有介紹)。</span><span class="sxs-lookup"><span data-stu-id="7e377-233">The example scenario for this document is a machine utilization KPI (introduced at the beginning of the guide).</span></span> <span data-ttu-id="7e377-234">我們可以選擇以機率解譯資料，並假設如果機器正在傳送資料，則表示正使用該機器。</span><span class="sxs-lookup"><span data-stu-id="7e377-234">We could opt for a naive interpretation of the data and assume that if the machine is sending data then it is being utilized.</span></span> <span data-ttu-id="7e377-235">不過，機器可能會在未真正產生任何東西的情況下傳送資料 (例如，可能處於閒置狀態，或正在維護中)。</span><span class="sxs-lookup"><span data-stu-id="7e377-235">However, the machine could be sending data while not really producing anything (for example, it could be idle, or being maintained).</span></span> <span data-ttu-id="7e377-236">這突顯出嘗試從 IoT 資料中擷取見解時所面臨的一項常見挑戰：您正在尋找的資料不在您取得的資料中。</span><span class="sxs-lookup"><span data-stu-id="7e377-236">This highlights a very common challenge when trying to extract insight out of IoT data: the data you are looking for is not available in the data you are getting.</span></span> <span data-ttu-id="7e377-237">所以，在本例中，我們並未得到能清楚、明確地告訴我們機器是否正在生產的資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-237">So, in our example, we are not getting data clearly and unequivocally telling us whether or not the machine is producing.</span></span>  <span data-ttu-id="7e377-238">因此，我們需要將獲得的資料與其他資料來源結合，以推斷使用率，並套用規則來確定機器是否正在生產。</span><span class="sxs-lookup"><span data-stu-id="7e377-238">Therefore, we need to infer utilization by combining the data we are getting with other sources of data, and applying rules to determine of whether or not the machine is producing.</span></span> <span data-ttu-id="7e377-239">此外，這些規則可能會因公司而異，因其對「生產」可能有不同的解釋。</span><span class="sxs-lookup"><span data-stu-id="7e377-239">In addition, these rules may change from company to company since they may have different interpretations of what “producing” is.</span></span> <span data-ttu-id="7e377-240">經常性路徑是在資料流經系統時進行分析。</span><span class="sxs-lookup"><span data-stu-id="7e377-240">The warm path is all about analyzing as the data flows through the system.</span></span> <span data-ttu-id="7e377-241">我們會近乎即時處理此資料流，將其儲存到經常性儲存，然後將其推送到分析用戶端。</span><span class="sxs-lookup"><span data-stu-id="7e377-241">We process this stream in near-real time, save it to the warm storage, and push it to the analytics clients.</span></span>

<span data-ttu-id="7e377-242">Azure 事件中樞是巨量資料串流平台和事件擷取服務，每秒可接收和處理數百萬個事件。</span><span class="sxs-lookup"><span data-stu-id="7e377-242">Azure Event Hubs is a big data streaming platform and event ingestion service, capable of receiving and processing millions of events per second.</span></span> <span data-ttu-id="7e377-243">事件中樞可以處理及儲存分散式軟體和裝置所產生的事件、資料或遙測。</span><span class="sxs-lookup"><span data-stu-id="7e377-243">Event Hubs can process and store events, data, or telemetry produced by distributed software and devices.</span></span> <span data-ttu-id="7e377-244">傳送至事件中樞的資料可以透過任何即時分析提供者或批次/儲存體配接器來轉換和儲存。</span><span class="sxs-lookup"><span data-stu-id="7e377-244">Data sent to an event hub can be transformed and stored using any real-time analytics provider or batching/storage adapters.</span></span> <span data-ttu-id="7e377-245">事件中樞非常適合作為資料流程之經常性路徑中的第一步。</span><span class="sxs-lookup"><span data-stu-id="7e377-245">Event Hubs makes the perfect match for the first step in the warm path for the data flow.</span></span>

<span data-ttu-id="7e377-246">下圖顯示速度層階段。</span><span class="sxs-lookup"><span data-stu-id="7e377-246">The figure below shows the speed layer stage.</span></span> <span data-ttu-id="7e377-247">它是由事件中樞、串流分析執行個體，以及經常性儲存的資料存放區所組成。</span><span class="sxs-lookup"><span data-stu-id="7e377-247">It consists of an event hub, a Stream Analytics instance, and a data store for warm storage.</span></span>

![Lambda 架構：速度層反白顯示。](assets/extracting-insights-from-iot/lambda-2.png)
  
<span data-ttu-id="7e377-249">Azure 平台提供許多選項來處理事件中樞上的事件，不過，我們建議使用串流分析。</span><span class="sxs-lookup"><span data-stu-id="7e377-249">The Azure platform provides many options for processing the events on an Event Hub, however, we recommend Stream Analytics.</span></span> <span data-ttu-id="7e377-250">串流分析也可以將資料推送至 Power BI 服務，以視覺化串流資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-250">Stream Analytics can also push data to the Power BI service to visualize streamed data.</span></span>

<span data-ttu-id="7e377-251">串流分析可執行大規模的複雜分析，例如，輪轉/滑動/跳動視窗、資料流彙總，以及外部資料來源聯結。</span><span class="sxs-lookup"><span data-stu-id="7e377-251">Stream Analytics can execute complex analysis at scale, for example, tumbling/sliding/hopping windows, stream aggregations, and external data source joins.</span></span> <span data-ttu-id="7e377-252">對於更複雜的處理，可以藉由串聯事件中樞、串流分析作業，以及 Azure Functions 的多個執行個體以擴充效能，如下圖所示。</span><span class="sxs-lookup"><span data-stu-id="7e377-252">For even more complex processing, performance can be extended by cascading multiple instances of Event Hubs, Stream Analytics jobs, and Azure functions, as shown in the following figure.</span></span>

![事件中樞到分析到 Power BI。](assets/extracting-insights-from-iot/event-hubs-to-power-bi.png)
  
<span data-ttu-id="7e377-254">可使用 Azure 平台上的各種服務 (例如 Azure SQL Database) 實作經常性儲存。</span><span class="sxs-lookup"><span data-stu-id="7e377-254">Warm storage can be implemented with various services on the Azure platform, such as Azure SQL Database.</span></span> <span data-ttu-id="7e377-255">建議使用 [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-255">We recommend [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-256">它是 Microsoft 全球發行的多模型資料庫。</span><span class="sxs-lookup"><span data-stu-id="7e377-256">It is Microsoft's globally distributed, multi-model database.</span></span> <span data-ttu-id="7e377-257">適用於資料集，其可從彈性的、不使用結構描述、自動編制索引，以及豐富的查詢介面中受益。</span><span class="sxs-lookup"><span data-stu-id="7e377-257">It is best for datasets that can benefit from flexible, schema-agnostic, automatic indexing, and rich query interfaces.</span></span> <span data-ttu-id="7e377-258">Cosmos DB 允許多區域的讀取/寫入，除了自動容錯移轉以外，也支援手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="7e377-258">Cosmos DB allows multi-region, read/write, and supports manual failover in addition to automatic failover.</span></span> <span data-ttu-id="7e377-259">此外，Cosmos DB 可讓使用者在其資料上設定存留時間 (TTL)，這會使舊資料自動到期。</span><span class="sxs-lookup"><span data-stu-id="7e377-259">In addition, Cosmos DB allows the user to set a time-to-live (TTL) on their data, which makes expiring old data automatic.</span></span> <span data-ttu-id="7e377-260">建議使用此功能來控制記錄存留在資料庫中的時間，進而控制資料庫的大小。</span><span class="sxs-lookup"><span data-stu-id="7e377-260">We recommend using the feature to control the time the records stay in the database, thus controlling the database size.</span></span>

<span data-ttu-id="7e377-261">Cosmos DB 的價格是根據使用的儲存體和佈建的[要求單位](https://docs.microsoft.com/azure/cosmos-db/request-units)。</span><span class="sxs-lookup"><span data-stu-id="7e377-261">Pricing for Cosmos DB is based on storage used and [request units](https://docs.microsoft.com/azure/cosmos-db/request-units) provisioned.</span></span> <span data-ttu-id="7e377-262">Cosmos DB 適用於不需要涉及大型資料集的查詢案例，因為這些查詢需要比基本查詢 (例如裝置的最後一個事件) 更多的要求單位。</span><span class="sxs-lookup"><span data-stu-id="7e377-262">Cosmos DB is best for scenarios that do not require queries involving aggregation over large sets of data, as those queries require more request units than a basic query such as the last event for a device.</span></span>  

<span data-ttu-id="7e377-263">[Microsoft Power BI](https://docs.microsoft.com/power-bi/power-bi-overview?WT.mc_id=iotinsightssoln-docs-ercenk) 是軟體服務、應用程式和連接器的集合，它們協同運作，將不相關的資料來源轉換為一致、視覺逼真，且互動式的見解。</span><span class="sxs-lookup"><span data-stu-id="7e377-263">[Microsoft Power BI](https://docs.microsoft.com/power-bi/power-bi-overview?WT.mc_id=iotinsightssoln-docs-ercenk) is a collection of software services, apps, and connectors that work together to turn your unrelated sources of data into coherent, visually immersive, and interactive insights.</span></span> <span data-ttu-id="7e377-264">Power BI 可協助您掌握重要資訊。</span><span class="sxs-lookup"><span data-stu-id="7e377-264">Power BI helps you stay up to date with the information that matters to you.</span></span> <span data-ttu-id="7e377-265">您可以利用 [Power BI 中的即時串流](https://docs.microsoft.com/power-bi/service-real-time-streaming?WT.mc_id=iotinsightssoln-docs-ercenk)，將資料推送至服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-265">You can utilize the [real-time streaming in Power BI](https://docs.microsoft.com/power-bi/service-real-time-streaming?WT.mc_id=iotinsightssoln-docs-ercenk) to push data to the service.</span></span> <span data-ttu-id="7e377-266">此即時串流可作為 Power BI 儀表板上各種視覺效果的即時串流資料來源。</span><span class="sxs-lookup"><span data-stu-id="7e377-266">This real time stream can act as a real time streaming data source for various visuals on the Power BI dashboard.</span></span>

## <a name="cold-path"></a><span data-ttu-id="7e377-267">非經常性路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-267">Cold Path</span></span>

<span data-ttu-id="7e377-268">經常性路徑是隨著時間為了探索模式而發生串流處理的地方。</span><span class="sxs-lookup"><span data-stu-id="7e377-268">The warm path is where the stream processing occurs to discover patterns over time.</span></span> <span data-ttu-id="7e377-269">不過，我們也想透過不同的樞軸和彙總，計算一段時間內的使用率，例如機器、生產線、工廠、生產部件等。</span><span class="sxs-lookup"><span data-stu-id="7e377-269">However we also would like to calculate the utilization over a period of time in the past, with different pivots, and aggregations, such as machine, line, plant, produced part etcetera.</span></span> <span data-ttu-id="7e377-270">我們希望將這些結果與經常性路徑結果合併，以向使用者呈現統一的檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-270">We  want to merge those results with the warm path results to present a unified view to the user.</span></span> <span data-ttu-id="7e377-271">非經常性路徑包括批次層和服務層。</span><span class="sxs-lookup"><span data-stu-id="7e377-271">The cold path includes the batch layer and the serving layers.</span></span> <span data-ttu-id="7e377-272">該組合提供長期的系統檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-272">The combination provides a long-term view of the system.</span></span>

<span data-ttu-id="7e377-273">非經常性路徑包含解決方案的長期資料存放區。</span><span class="sxs-lookup"><span data-stu-id="7e377-273">The cold path contains the long-term data store for the solution.</span></span> <span data-ttu-id="7e377-274">它也包含批次層，該層會建立預先計算的彙總檢視，以便在很長一段時間內提供快速查詢回應。</span><span class="sxs-lookup"><span data-stu-id="7e377-274">It also contains the batch layer, which creates pre-calculated aggregate views to provide fast query responses over long periods of time.</span></span> <span data-ttu-id="7e377-275">Azure 平台上此層可用的技術選項非常多樣化。</span><span class="sxs-lookup"><span data-stu-id="7e377-275">The technology options available for this layer on Azure platform is quite diverse.</span></span>

![Lambda 架構：批次層反白顯示。](assets/extracting-insights-from-iot/lambda-3.png)
  
<span data-ttu-id="7e377-277">[Azure 時間序列深入解析](https://docs.microsoft.com/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) (TSI) 是時間序列資料的分析、儲存體及視覺效果服務。</span><span class="sxs-lookup"><span data-stu-id="7e377-277">[Azure Time Series Insights](https://docs.microsoft.com/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) (TSI) is an analytics, storage and visualization service for time series data.</span></span> <span data-ttu-id="7e377-278">它提供類似 SQL 的篩選和彙總，減少了對使用者定義函式的需求。</span><span class="sxs-lookup"><span data-stu-id="7e377-278">It provides SQL-like filtering and aggregation, alleviating the need for user-defined functions.</span></span> <span data-ttu-id="7e377-279">TSI 可以接收來自事件中樞、IoT 中樞或 Azure Blob 儲存體的資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-279">TSI can receive data from Event Hubs, IoT Hub or Azure Blob storage.</span></span> <span data-ttu-id="7e377-280">TSI 中的所有資料都會儲存在記憶體內部和 SSD 中，以確保資料一律可用於互動式分析。</span><span class="sxs-lookup"><span data-stu-id="7e377-280">All data in TSI is stored in-memory and in SSDs, which ensures that the data is always ready for interactive analytics.</span></span> <span data-ttu-id="7e377-281">例如，數百萬個事件的一般彙總會以毫秒為單位傳回。</span><span class="sxs-lookup"><span data-stu-id="7e377-281">For example, a typical aggregation over tens of millions of events returns on the order of milliseconds.</span></span> <span data-ttu-id="7e377-282">它也提供視覺效果，例如不同時間序列的重疊、儀表板比較、可存取的表格式檢視，以及熱度圖。</span><span class="sxs-lookup"><span data-stu-id="7e377-282">It also provides visualizations such as overlays of different time series, dashboard comparisons, accessible tabular views, and heat maps.</span></span> <span data-ttu-id="7e377-283">TSI 的主要功能包括：</span><span class="sxs-lookup"><span data-stu-id="7e377-283">Key features of TSI include:</span></span>

-   <span data-ttu-id="7e377-284">內建的視覺效果服務，適用於無需立即報告資料的解決方案。</span><span class="sxs-lookup"><span data-stu-id="7e377-284">Built-in visualization services for solutions that do not need to report on data immediately.</span></span> <span data-ttu-id="7e377-285">TSI 有約略 30-60 秒的查詢資料記錄延遲時間。</span><span class="sxs-lookup"><span data-stu-id="7e377-285">TSI has an approximate latency for querying data records of 30-60 seconds.</span></span> 
-   <span data-ttu-id="7e377-286">可查詢大型資料集。</span><span class="sxs-lookup"><span data-stu-id="7e377-286">The ability to query large sets of data.</span></span>
-   <span data-ttu-id="7e377-287">使用者不限數量皆可進行無限量的查詢，且無需額外費用。</span><span class="sxs-lookup"><span data-stu-id="7e377-287">Any number of users can conduct an unlimited number of queries for no extra cost.</span></span>

<span data-ttu-id="7e377-288">TSI 的最大保留期為 400 天，最大儲存限制為 3TB。</span><span class="sxs-lookup"><span data-stu-id="7e377-288">TSI has a maximum retention of 400 days and a maximum storage limit of 3 TB.</span></span> <span data-ttu-id="7e377-289">如果您需要較長的保留期範圍或更多容量，請使用非經常性儲存體資料庫 (視需要交換資料至 TSI 查詢)。</span><span class="sxs-lookup"><span data-stu-id="7e377-289">If you require a longer retention span, or more capacity, use a cold storage database (swapping data into TSI for querying as needed).</span></span>

<span data-ttu-id="7e377-290">IoT 應用程式的非經常性儲存體一定會隨著時間增長。</span><span class="sxs-lookup"><span data-stu-id="7e377-290">Cold storage for an IoT application is certain to grow large over time.</span></span> <span data-ttu-id="7e377-291">這是資料長期儲存的位置，並在批次檢視中彙總，以供分析使用。</span><span class="sxs-lookup"><span data-stu-id="7e377-291">This is where data is stored for the long term and aggregated at the batch views for analytics.</span></span> <span data-ttu-id="7e377-292">ML 模型的資料也會儲存在這裡。</span><span class="sxs-lookup"><span data-stu-id="7e377-292">Data for ML models is also stored here.</span></span> <span data-ttu-id="7e377-293">建議針對非經常性儲存體使用 [Azure 儲存體](https://docs.microsoft.com/azure/storage/?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-293">We recommend [Azure Storage](https://docs.microsoft.com/azure/storage/?WT.mc_id=iotinsightssoln-docs-ercenk) for the cold storage.</span></span> <span data-ttu-id="7e377-294">它是 Microsoft 管理的服務，提供高度可用、安全、耐用、可擴充和備援的雲端儲存體。</span><span class="sxs-lookup"><span data-stu-id="7e377-294">It is a Microsoft-managed service providing cloud storage that is highly available, secure, durable, scalable, and redundant.</span></span> <span data-ttu-id="7e377-295">Azure 儲存體包含 Azure Blob (物件)、Azure Data Lake Storage Gen2、Azure 檔案服務、Azure 佇列和 Azure 資料表。</span><span class="sxs-lookup"><span data-stu-id="7e377-295">Azure Storage includes Azure Blobs (objects), Azure Data Lake Storage Gen2, Azure Files, Azure Queues, and Azure Tables.</span></span> <span data-ttu-id="7e377-296">非經常性儲存體可以是 Blob、Data Lake Storage Gen2，或 Azure 表格，或上述的組合。</span><span class="sxs-lookup"><span data-stu-id="7e377-296">The cold storage can be either Blobs, Data Lake Storage Gen2, or Azure Tables., or a combination of those.</span></span>

<span data-ttu-id="7e377-297">[Azure 表格儲存體](https://docs.microsoft.com/azure/cosmos-db/table-storage-overview?WT.mc_id=iotinsightssoln-docs-ercenk)是可將結構化的 NoSQL 資料儲存在雲端中的服務，並提供具有無結構描述設計的索引鍵/屬性存放區。</span><span class="sxs-lookup"><span data-stu-id="7e377-297">[Azure Table storage](https://docs.microsoft.com/azure/cosmos-db/table-storage-overview?WT.mc_id=iotinsightssoln-docs-ercenk) is a service that stores structured NoSQL data in the cloud, providing a key/attribute store with a schemaless design.</span></span> <span data-ttu-id="7e377-298">由於表格儲存體並無結構描述，因此可輕易隨著應用程式發展需求改寫資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-298">Because Table Storage is schemaless, it is easy to adapt your data as the needs of your application evolve.</span></span> <span data-ttu-id="7e377-299">相較於類似資料量的傳統 SQL，對許多類型的應用程式而言，表格儲存體資料可快速存取且符合成本效益，通常可降低成本。</span><span class="sxs-lookup"><span data-stu-id="7e377-299">Access to Table Storage data is fast and cost-effective for many types of applications and is typically lower in cost than traditional SQL for similar volumes of data.</span></span> <span data-ttu-id="7e377-300">我們將一個資料表作為樣本，並將另一個資料表用於從資料流接收的事件。</span><span class="sxs-lookup"><span data-stu-id="7e377-300">We use one table for samples, and one table for events that are received from data streams.</span></span> <span data-ttu-id="7e377-301">資料分割索引鍵的設計是一個特別重要的概念；兩個表格皆使用事件或樣本上的時間戳記 (小時)。</span><span class="sxs-lookup"><span data-stu-id="7e377-301">The design of the partition key is an especially important concept; both tables use the hour of the timestamp on the event or the sample.</span></span> <span data-ttu-id="7e377-302">如需詳細資訊，請參閱 [了解表格服務資料模型](https://docs.microsoft.com/rest/api/storageservices/Understanding-the-Table-Service-Data-Model?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-302">For more information, see [Understanding the Table Service Data Model](https://docs.microsoft.com/rest/api/storageservices/Understanding-the-Table-Service-Data-Model?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="7e377-303">若要儲存大量非結構化資料，例如 JSON，或包含 IoT 應用程式接收之未經處理資料的 XML 文件，[Blob 儲存體](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction?WT.mc_id=iotinsightssoln-docs-ercenk)、[Azure 檔案](https://docs.microsoft.com/azure/storage/files/storage-files-introduction?WT.mc_id=iotinsightssoln-docs-ercenk)，或 [Azure Data Lake Storage Gen2](https://docs.microsoft.com/azure/storage/data-lake-storage/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 是最適合的選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-303">To store massive amounts of unstructured data, such as JSON, or XML documents containing the unprocessed data received by the IoT application, [Blob storage](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction?WT.mc_id=iotinsightssoln-docs-ercenk), [Azure Files](https://docs.microsoft.com/azure/storage/files/storage-files-introduction?WT.mc_id=iotinsightssoln-docs-ercenk), or [Azure Data Lake Storage Gen2](https://docs.microsoft.com/azure/storage/data-lake-storage/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) are the best options.</span></span>

<span data-ttu-id="7e377-304">使用者可從世界各地透過 HTTP 或 HTTPS 安全地存取 Azure Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="7e377-304">Azure Blob storage can be accessed from anywhere in the world via HTTP or HTTPS securely.</span></span> <span data-ttu-id="7e377-305">必須使用服務使用的其中一種[授權機制](https://docs.microsoft.com/azure/storage/common/storage-auth?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk)，授權存取 Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="7e377-305">Access to the blob storage must be authorized using one of the [authorization mechanisms](https://docs.microsoft.com/azure/storage/common/storage-auth?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk) used by the service.</span></span> <span data-ttu-id="7e377-306">此服務提供多個複寫[選項](https://docs.microsoft.com/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk)：本地備援、區域備援、異地備援，以及讀取存取異地備援。</span><span class="sxs-lookup"><span data-stu-id="7e377-306">The service provides multiple replication [options](https://docs.microsoft.com/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk): locally redundant, zone-redundant, geo-redundant and read access geo-redundant.</span></span> <span data-ttu-id="7e377-307">另外還有三個[存取層](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?WT.mc_id=iotinsightssoln-docs-ercenk)，可提供最具成本效益的解決方案。</span><span class="sxs-lookup"><span data-stu-id="7e377-307">There are also three [access tiers](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?WT.mc_id=iotinsightssoln-docs-ercenk) that allows the most cost-effective solutions.</span></span>

<span data-ttu-id="7e377-308">一旦資料位於非經常性儲存體之後，必須建立 Lambda 架構之服務層上的批次檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-308">Once the data is in cold storage, batch views on the serving layer of the Lambda architecture need to be created.</span></span> <span data-ttu-id="7e377-309">[Azure Data Factory](https://docs.microsoft.com/azure/data-factory/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 是在服務層上建立批次檢視的絕佳解決方案。</span><span class="sxs-lookup"><span data-stu-id="7e377-309">[Azure Data Factory](https://docs.microsoft.com/azure/data-factory/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) is a great solution for creating the batch views on the serving layer.</span></span> <span data-ttu-id="7e377-310">這是一項雲端式受控資料整合服務，可讓您在雲端建立資料驅動工作流程，以便協調及自動進行資料移動和資料轉換。</span><span class="sxs-lookup"><span data-stu-id="7e377-310">It is a cloud-based managed data integration service that allows you to create data-driven workflows in the cloud for orchestrating and automating data movement and data transformation.</span></span> <span data-ttu-id="7e377-311">使用 Azure Data Factory，可以建立並排程[資料驅動的工作流程](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities?WT.mc_id=iotinsightssoln-docs-ercenk) (稱為管線)，它可以從不同的資料存放區擷取資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-311">Using Azure Data Factory, you can create and schedule [data-driven workflows](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities?WT.mc_id=iotinsightssoln-docs-ercenk) (called pipelines) that can ingest data from disparate data stores.</span></span> <span data-ttu-id="7e377-312">使用服務 (例如，[Azure HDInsight Hadoop](https://docs.microsoft.com/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk)[Spark](https://docs.microsoft.com/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk) 和 [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/?WT.mc_id=iotinsightssoln-docs-ercenk)) 可以處理和轉換資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-312">It can process and transform the data by using services such as [Azure HDInsight Hadoop](https://docs.microsoft.com/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk), [Spark](https://docs.microsoft.com/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk), and [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-313">這可讓您建置機器學習模型，並將其與分析用戶端搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7e377-313">This allows you to build machine learning models and consume them with the analytics clients.</span></span>

<span data-ttu-id="7e377-314">例如，如下圖所示，Data Factory 管線會從主要資料存放區中讀取資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-314">For example, as shown in the following figure, Data Factory pipelines read data from the master data store.</span></span> <span data-ttu-id="7e377-315">其中一個管線會總結並彙總資料以填入 Azure 資料倉儲的執行個體。</span><span class="sxs-lookup"><span data-stu-id="7e377-315">One pipeline summarizes and aggregates the data to populate an instance of Azure Data Warehouse.</span></span> <span data-ttu-id="7e377-316">Data Factory 管線也包含 [Azure Databricks 筆記本活動](https://docs.microsoft.com/azure/data-factory/transform-data-using-databricks-notebook?WT.mc_id=iotinsightssoln-docs-ercenk)，用於建置機器學習服務模型。</span><span class="sxs-lookup"><span data-stu-id="7e377-316">The Data Factory pipeline also and contains [Azure Databricks notebook activities](https://docs.microsoft.com/azure/data-factory/transform-data-using-databricks-notebook?WT.mc_id=iotinsightssoln-docs-ercenk) that are used to build ML models.</span></span>

![Lambda 架構：批次層反白顯示。](assets/extracting-insights-from-iot/master-data-to-ml-analytics.png)
  
<span data-ttu-id="7e377-318">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/?WT.mc_id=iotinsightssoln-docs-ercenk) 或 [Azure SQL 資料倉儲](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-overview-what-is?WT.mc_id=iotinsightssoln-docs-ercenk)是主控批次檢視的最佳選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-318">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/?WT.mc_id=iotinsightssoln-docs-ercenk) or [Azure SQL Data Warehouse](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-overview-what-is?WT.mc_id=iotinsightssoln-docs-ercenk) are the best options for hosting the batch views.</span></span> <span data-ttu-id="7e377-319">這些服務可以為主要資料提供預先計算和彙總的檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-319">These services can serve pre-calculated and aggregated views on the master data.</span></span> 

<span data-ttu-id="7e377-320">Azure SQL Database (SQL DB) 是關聯式資料庫即服務，它是根據最新版本的 Microsoft SQL Server 資料庫引擎而建置。</span><span class="sxs-lookup"><span data-stu-id="7e377-320">Azure SQL Database (SQL DB) is a relational database-as-a-service based on the latest version of Microsoft SQL Server Database Engine.</span></span> <span data-ttu-id="7e377-321">SQL DB 是高效能、可靠且安全的資料庫，您可以使用該資料庫來建置資料驅動應用程式和網站。</span><span class="sxs-lookup"><span data-stu-id="7e377-321">SQL DB is a high-performance, reliable, and secure database you can use to build data-driven applications and websites.</span></span> <span data-ttu-id="7e377-322">作為 Azure 服務，無需管理其基礎結構。</span><span class="sxs-lookup"><span data-stu-id="7e377-322">As an Azure service,  there is no need to manage its infrastructure.</span></span> <span data-ttu-id="7e377-323">隨著資料量不斷增加，解決方案可以開始使用彙總和儲存資料的技術，以加快查詢速度。</span><span class="sxs-lookup"><span data-stu-id="7e377-323">As the data volume increases, the solution can start using techniques to aggregate and store data for speeding up the queries.</span></span> <span data-ttu-id="7e377-324">預先計算彙總是眾所皆知的技術，特別適用於僅附加資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-324">Pre-calculating aggregations is a well-known technique, especially for append-only data.</span></span> <span data-ttu-id="7e377-325">它對於管理成本也相當有幫助。</span><span class="sxs-lookup"><span data-stu-id="7e377-325">It is also useful for managing costs.</span></span>

<span data-ttu-id="7e377-326">Azure SQL 資料倉儲提供許多其他功能，在某些情況下非常有用。</span><span class="sxs-lookup"><span data-stu-id="7e377-326">Azure SQL Data Warehouse provides many additional features that can be useful in some scenarios.</span></span> <span data-ttu-id="7e377-327">它是雲端式企業資料倉儲，利用大量平行處理，快速地在數以 PB 計的資料中執行複雜的查詢。</span><span class="sxs-lookup"><span data-stu-id="7e377-327">It is a cloud-based enterprise data warehouse that leverages massively parallel processing  to quickly run complex queries across petabytes of data.</span></span> <span data-ttu-id="7e377-328">如果您需要保留 PB 規模的資料，並且希望快速執行查詢，我們建議使用 SQL 資料倉儲。</span><span class="sxs-lookup"><span data-stu-id="7e377-328">If you need to keep petabytes of data, and want to have queries running fast, we recommend SQL Data Warehouse.</span></span>

## <a name="visualizing-the-data"></a><span data-ttu-id="7e377-329">將資料視覺化</span><span class="sxs-lookup"><span data-stu-id="7e377-329">Visualizing the data</span></span>

<span data-ttu-id="7e377-330">在此層中，我們希望合併兩個資料管線 (經常性路徑和非經常性路徑)，以呈現資料的緊密檢視。</span><span class="sxs-lookup"><span data-stu-id="7e377-330">At this layer, we want to merge the two data pipelines (warm and cold paths) to present a cohesive view of the data.</span></span> <span data-ttu-id="7e377-331">在此範例中，我們會使用多個計量來推論經常性和非經常性路徑上的機器的使用量。</span><span class="sxs-lookup"><span data-stu-id="7e377-331">In this example, we used multiple metrics to deduce the utilization of the machine on both warm and cold paths.</span></span> <span data-ttu-id="7e377-332">在分析階段中，我們提供從這些路徑合併資料的視覺效果。</span><span class="sxs-lookup"><span data-stu-id="7e377-332">In the analytics stage, we provide visualizations that combine the data from those paths.</span></span>

![Lambda 架構：分析用戶端層級反白顯示。](assets/extracting-insights-from-iot/lambda-4.png)

<span data-ttu-id="7e377-334">[Microsoft Power BI](https://docs.microsoft.com/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk) 和 [Azure 時間序列深入解析](https://docs.microsoft.com/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk)提供現成的資料視覺效果。</span><span class="sxs-lookup"><span data-stu-id="7e377-334">[Microsoft Power BI](https://docs.microsoft.com/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk) and [Azure Time Series Insights](https://docs.microsoft.com/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) provide data visualizations out-of-the-box.</span></span> <span data-ttu-id="7e377-335">Power BI 是一個商務分析解決方案，可讓您將資料視覺化，並在整個組織共用見解，或將其嵌入您的應用程式或網站。</span><span class="sxs-lookup"><span data-stu-id="7e377-335">Power BI is business analytics solution that lets you visualize your data and share insights across your organization, or embed them in your app or website.</span></span> <span data-ttu-id="7e377-336">[Power BI Desktop](https://powerbi.microsoft.com/desktop/?WT.mc_id=iotinsightssoln-docs-ercenk) 是免費且功能強大的工具，用於模型化報表，及其基礎資料來源。</span><span class="sxs-lookup"><span data-stu-id="7e377-336">[Power BI Desktop](https://powerbi.microsoft.com/desktop/?WT.mc_id=iotinsightssoln-docs-ercenk) is a free and powerful tool for modelling reports and their underlying data sources.</span></span>  <span data-ttu-id="7e377-337">內嵌 Power BI 視覺效果的應用程式使用桌上型電腦工具所撰寫，並裝載於 Power BI 服務上的報表。</span><span class="sxs-lookup"><span data-stu-id="7e377-337">The applications embedding Power BI visualizations use the reports authored by the desktop tool and hosted on the Power BI Service.</span></span>

<span data-ttu-id="7e377-338">時間序列深入解析具有資料總管，以視覺化並查詢資料以及 REST 查詢 API。</span><span class="sxs-lookup"><span data-stu-id="7e377-338">Time Series Insights has a data explorer to visualize and query data as well as REST query APIs.</span></span> <span data-ttu-id="7e377-339">此外，它也公開 JavaScript 控制項程式庫，可讓您將 TSI 驅動的圖表嵌入自訂應用程式中。</span><span class="sxs-lookup"><span data-stu-id="7e377-339">Further, it exposes a JavaScript controls library that lets you embed TSI-powered charts into custom applications.</span></span> <span data-ttu-id="7e377-340">以下是 TSI 上的基本熱度圖檢視，用於顯示接近現場機器使用率的傳入資料，只需查看觀察到的樣品數量即可。</span><span class="sxs-lookup"><span data-stu-id="7e377-340">The following is a basic heatmap view on the TSI for the incoming data that approximates the utilization of the machines on the shop floor, by simply looking at the number of samples observed.</span></span>

![Lambda 架構：批次層反白顯示。](assets/extracting-insights-from-iot/client-screen.png)

<span data-ttu-id="7e377-342">如果您需要以瀏覽器為基礎的使用者介面來彙總多個來源的資料，TSI 和 Power BI 服務都允許嵌入視覺效果控制項。</span><span class="sxs-lookup"><span data-stu-id="7e377-342">If you require a browser-based user interface that aggregates data from multiple sources, both TSI and Power BI services allow embedding visualization controls.</span></span> <span data-ttu-id="7e377-343">兩者都提供 REST API ([Power BI Rest API](https://docs.microsoft.com/rest/api/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk)[TSI REST API](https://docs.microsoft.com/rest/api/time-series-insights/time-series-insights-reference-queryapi?WT.mc_id=iotinsightssoln-docs-ercenk)) 和 JavaScript SDKs ([Power BI JavaScript SDK](https://github.com/Microsoft/PowerBI-JavaScript?WT.mc_id=iotinsightssoln-docs-ercenk)、[TSI JavaScript SDK](https://docs.microsoft.com/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk))，允許大規模的自訂。</span><span class="sxs-lookup"><span data-stu-id="7e377-343">Both also provide REST APIs ([Power BI Rest API](https://docs.microsoft.com/rest/api/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk), [TSI REST API](https://docs.microsoft.com/rest/api/time-series-insights/time-series-insights-reference-queryapi?WT.mc_id=iotinsightssoln-docs-ercenk)) and JavaScript SDKs ([Power BI JavaScript SDK](https://github.com/Microsoft/PowerBI-JavaScript?WT.mc_id=iotinsightssoln-docs-ercenk), [TSI JavaScript SDK](https://docs.microsoft.com/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk)) that allows extensive customizations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7e377-344">後續步驟</span><span class="sxs-lookup"><span data-stu-id="7e377-344">Next Steps</span></span>

<span data-ttu-id="7e377-345">我們介紹許多概念，並希望提供讀者一套起點，以深入了解，並將這些技術應用於他們自己的需求。</span><span class="sxs-lookup"><span data-stu-id="7e377-345">We covered a lot of concepts and would like to give the reader a set of starting points to learn more and apply the techniques to their own requirements.</span></span> <span data-ttu-id="7e377-346">以下是我們認為對此用途相當有用的一些教學課程。</span><span class="sxs-lookup"><span data-stu-id="7e377-346">Here are some tutorials we believe can be useful for this purpose.</span></span>

- <span data-ttu-id="7e377-347">將資料轉換至串流</span><span class="sxs-lookup"><span data-stu-id="7e377-347">Converting the data to a stream</span></span>
  - [<span data-ttu-id="7e377-348">建立定期執行的 Logic App</span><span class="sxs-lookup"><span data-stu-id="7e377-348">Creating a Logic App running on a schedule</span></span>](https://docs.microsoft.com/azure/logic-apps/tutorial-build-schedule-recurring-logic-app-workflow?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="7e377-349">Logic Apps 上資料作業的程式碼範例</span><span class="sxs-lookup"><span data-stu-id="7e377-349">Code examples for data operations on Logic Apps</span></span>](https://docs.microsoft.com/azure/logic-apps/logic-apps-data-operations-code-samples?WT.mc_id=iotinsightssoln-docs-ercenk)
  - <span data-ttu-id="7e377-350">[在容器中執行 Azure Functions](https://docs.microsoft.com/azure/azure-functions/functions-create-function-linux-custom-image?WT.mc_id=iotinsightssoln-docs-ercenk)以裝載您的 Azure Function，這涵蓋在多項課程中。</span><span class="sxs-lookup"><span data-stu-id="7e377-350">[Running Azure Functions in a container](https://docs.microsoft.com/azure/azure-functions/functions-create-function-linux-custom-image?WT.mc_id=iotinsightssoln-docs-ercenk) to host your Azure Function is covered in multiple places.</span></span> <span data-ttu-id="7e377-351">包括使用自訂映像在 Linux 上建立函式、在任何平台上執行函式，以及Azure Functions 執行階段的 Docker 映像</span><span class="sxs-lookup"><span data-stu-id="7e377-351">Creating a function on Linux using a custom image, running functions on any platform, Docker images for Azure Functions Runtime</span></span>
  - [<span data-ttu-id="7e377-352">在 Azure Functions 使用各種繫結</span><span class="sxs-lookup"><span data-stu-id="7e377-352">Using various bindings on Azure Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings?WT.mc_id=iotinsightssoln-docs-ercenk)

- <span data-ttu-id="7e377-353">最忙碌路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-353">Hot path</span></span>
  - <span data-ttu-id="7e377-354">端到端教學課程示範如何使用事件中樞、Azure 串流分析，以及 Power BI。</span><span class="sxs-lookup"><span data-stu-id="7e377-354">End-to-end tutorials demonstrating the use of Event Hubs, Azure Stream Analytics and Power BI.</span></span> <span data-ttu-id="7e377-355">請參閱[教學課程：在傳送至 Azure 事件中樞的即時事件中視覺化資料異常](https://docs.microsoft.com/azure/event-hubs/event-hubs-tutorial-visualize-anomalies?WT.mc_id=iotinsightssoln-docs-ercenk)，以及[建立串流分析作業來分析通話資料，並且在 Power BI 儀表板中將結果視覺化](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-manage-job?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-355">See [Tutorial: Visualize data anomalies](https://docs.microsoft.com/azure/event-hubs/event-hubs-tutorial-visualize-anomalies?WT.mc_id=iotinsightssoln-docs-ercenk) in real-time events sent to Azure Event Hubs, and [Create a Stream Analytics job to analyze phone call data](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-manage-job?WT.mc_id=iotinsightssoln-docs-ercenk) and visualize results in a Power BI dashboard.</span></span>
  <span data-ttu-id="7e377-356">-[將 Azure Cosmos DB 與與 .NET 搭配使用](https://docs.microsoft.com/azure/cosmos-db/sql-api-get-started?WT.mc_id=iotinsightssoln-docs-ercenk)</span><span class="sxs-lookup"><span data-stu-id="7e377-356">-[Using Azure Cosmos DB with .NET](https://docs.microsoft.com/azure/cosmos-db/sql-api-get-started?WT.mc_id=iotinsightssoln-docs-ercenk)</span></span>
- <span data-ttu-id="7e377-357">非經常性路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-357">Cold path</span></span>
  - <span data-ttu-id="7e377-358">[使用 Azure Data Factory 中的 Spark 活動來轉換雲端中的資料](https://docs.microsoft.com/azure/data-factory/tutorial-transform-data-spark-portal?WT.mc_id=iotinsightssoln-docs-ercenk)</span><span class="sxs-lookup"><span data-stu-id="7e377-358">[Transforming data in the cloud by using a Spark activity](https://docs.microsoft.com/azure/data-factory/tutorial-transform-data-spark-portal?WT.mc_id=iotinsightssoln-docs-ercenk) in Azure Data Factory</span></span>
  - [<span data-ttu-id="7e377-359">在時間序列深入解析上分析模擬裝置資料</span><span class="sxs-lookup"><span data-stu-id="7e377-359">Analyzing simulated device data on Time Series Insights</span></span>](https://docs.microsoft.com/azure/time-series-insights/tutorial-create-populate-tsi-environment?WT.mc_id=iotinsightssoln-docs-ercenk)
- <span data-ttu-id="7e377-360">分析用戶端</span><span class="sxs-lookup"><span data-stu-id="7e377-360">Analysis clients</span></span>
  - [<span data-ttu-id="7e377-361">了解 Power BI</span><span class="sxs-lookup"><span data-stu-id="7e377-361">Learning Power BI</span></span>](https://docs.microsoft.com/power-bi/guided-learning/?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="7e377-362">建立時間序列深入解析 SPA</span><span class="sxs-lookup"><span data-stu-id="7e377-362">Creating a Time Series Insights SPA</span></span>](https://docs.microsoft.com/azure/time-series-insights/tutorial-create-tsi-sample-spa?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="7e377-363">探索時間序列深入解析 JAVA 指令碼用戶端程式庫</span><span class="sxs-lookup"><span data-stu-id="7e377-363">Exploring Time Series Insights Java Script client library</span></span>](https://docs.microsoft.com/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk)
  - <span data-ttu-id="7e377-364">請參閱 [TSI 示範](https://insights.timeseries.azure.com/demo)和 [Power BI 示範](https://microsoft.github.io/PowerBI-JavaScript/demo/v2-demo/index.html).</span><span class="sxs-lookup"><span data-stu-id="7e377-364">See the [TSI demo](https://insights.timeseries.azure.com/demo) and [Power BI demo](https://microsoft.github.io/PowerBI-JavaScript/demo/v2-demo/index.html).</span></span>

## <a name="appendix-pillars-of-software-quality-posq"></a><span data-ttu-id="7e377-365">附錄：軟體品質的要素 (PoSQ)</span><span class="sxs-lookup"><span data-stu-id="7e377-365">Appendix: Pillars of software quality (PoSQ)</span></span>

<span data-ttu-id="7e377-366">成功的雲端應用程式會建置在下列[軟體品質的要素](https://docs.microsoft.com/azure/architecture/guide/pillars?WT.mc_id=iotinsightssoln-docs-ercenk)：延展性、可用性、復原功能、管理和安全性。</span><span class="sxs-lookup"><span data-stu-id="7e377-366">A successful cloud application is built on these [pillars of software quality](https://docs.microsoft.com/azure/architecture/guide/pillars?WT.mc_id=iotinsightssoln-docs-ercenk): Scalability, availability, resiliency, management, and security.</span></span> <span data-ttu-id="7e377-367">在本節中，我們將視需要簡要討論每個元件的要素。</span><span class="sxs-lookup"><span data-stu-id="7e377-367">In this section, we will briefly cover those pillars for each component as necessary.</span></span> <span data-ttu-id="7e377-368">我們未涵蓋可用性、彈性、管理和 DevOps，因為大部分是在實作層級處理，而且我們想提到的是 Azure 平台提供廣泛的方法，透過 API、工具、診斷和記錄來達成這些目標。</span><span class="sxs-lookup"><span data-stu-id="7e377-368">We don’t cover availability, resiliency, management and DevOps, since they are mostly addressed at the implementation level, and we want to mention Azure platform provides extensive means for achieving those through APIs, tools, diagnostics and logging.</span></span> <span data-ttu-id="7e377-369">除了上述要件，我們也會提及成本效益。</span><span class="sxs-lookup"><span data-stu-id="7e377-369">In addition to the mentioned pillars, we will also mention cost efficiency.</span></span>

<span data-ttu-id="7e377-370">讓我們快速檢閱這些要素：</span><span class="sxs-lookup"><span data-stu-id="7e377-370">Let’s quickly review those pillars:</span></span>

- <span data-ttu-id="7e377-371">**延展性**是系統處理負載增加的能力。</span><span class="sxs-lookup"><span data-stu-id="7e377-371">**Scalability** is the ability of a system to handle increased load.</span></span> <span data-ttu-id="7e377-372">應用程式有兩種主要的調整方式。</span><span class="sxs-lookup"><span data-stu-id="7e377-372">There are two main ways that an application can scale.</span></span> <span data-ttu-id="7e377-373">垂直調整 (「相應增加」) 代表增加資源的容量，例如使用較大的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="7e377-373">Vertical scaling (scaling up) means increasing the capacity of a resource, for example by using a larger VM size.</span></span> <span data-ttu-id="7e377-374">水平調整 (「相應放大」) 則會為資源 (例如 VM 或資料庫複本) 新增執行個體。</span><span class="sxs-lookup"><span data-stu-id="7e377-374">Horizontal scaling (scaling out) is adding new instances of a resource, such as VMs or database replicas.</span></span> <span data-ttu-id="7e377-375">延展性要素也包括效能和處理負載的能力。</span><span class="sxs-lookup"><span data-stu-id="7e377-375">The scalability pillar also includes performance and the ability to handle load.</span></span>
- <span data-ttu-id="7e377-376">**可用性**是系統正常運作並執行作業的時間比例。</span><span class="sxs-lookup"><span data-stu-id="7e377-376">**Availability** is the proportion of time that the system is functional and working.</span></span> <span data-ttu-id="7e377-377">通常以運作時間百分比加以測量。</span><span class="sxs-lookup"><span data-stu-id="7e377-377">It is usually measured as a percentage of uptime.</span></span> <span data-ttu-id="7e377-378">應用程式錯誤、基礎結構問題和系統負載全都有可能會降低可用性。</span><span class="sxs-lookup"><span data-stu-id="7e377-378">Application errors, infrastructure problems, and system load can all reduce availability.</span></span> <span data-ttu-id="7e377-379">Microsoft Azure 服務的服務等級協定已發佈，並且可在[服務等級協定](https://azure.microsoft.com/support/legal/sla/?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-379">The service level agreements for Microsoft Azure services are published and available at [Service Level Agreements](https://azure.microsoft.com/support/legal/sla/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-380">可用性是系統層級唯一有意義的計量。</span><span class="sxs-lookup"><span data-stu-id="7e377-380">Availability is the only meaningful metric at the system level.</span></span> <span data-ttu-id="7e377-381">個別元件有助於系統的整體可用性。</span><span class="sxs-lookup"><span data-stu-id="7e377-381">Separate components contribute to the overall availability of the system.</span></span>
- <span data-ttu-id="7e377-382">**災害復原**是指系統從失敗中復原並繼續運作的能力。</span><span class="sxs-lookup"><span data-stu-id="7e377-382">**Resiliency** is the ability of the system to recover from failures and continue to function.</span></span> <span data-ttu-id="7e377-383">災害復原的目標是使應用程式在發生失敗後，能夠恢復到完全正常運作的狀態。</span><span class="sxs-lookup"><span data-stu-id="7e377-383">The goal of resiliency is to return the application to a fully functioning state after a failure occurs.</span></span> <span data-ttu-id="7e377-384">災害復原與可用性緊密相關。</span><span class="sxs-lookup"><span data-stu-id="7e377-384">Resiliency is closely related to availability.</span></span>
- <span data-ttu-id="7e377-385">**管理性和 DevOps**。</span><span class="sxs-lookup"><span data-stu-id="7e377-385">**Management and DevOps**.</span></span> <span data-ttu-id="7e377-386">此要素涵蓋讓應用程式在生產環境中執行的作業流程。</span><span class="sxs-lookup"><span data-stu-id="7e377-386">This pillar covers the operations processes that keep an application running in production.</span></span> <span data-ttu-id="7e377-387">部署必須可靠且可預測。</span><span class="sxs-lookup"><span data-stu-id="7e377-387">Deployments must be reliable and predictable.</span></span> <span data-ttu-id="7e377-388">應將部署程序自動化，以避免發生人為錯誤。</span><span class="sxs-lookup"><span data-stu-id="7e377-388">They should be automated to reduce the chance of human error.</span></span> <span data-ttu-id="7e377-389">部署程序應迅速且成為例行工作，以免拖累新功能或錯誤修正的發行速度。</span><span class="sxs-lookup"><span data-stu-id="7e377-389">They should be a fast and routine process, so they do not slow down the release of new features or bug fixes.</span></span> <span data-ttu-id="7e377-390">同樣重要的是，您必須能夠在更新發生問題時快速復原或向前復原。</span><span class="sxs-lookup"><span data-stu-id="7e377-390">Equally important, you must be able to quickly roll back or roll forward if an update has problems.</span></span>
- <span data-ttu-id="7e377-391">**安全性**應該是解決方案之整個生命週期 (從設計和實作到部署與作業) 的主要重點。</span><span class="sxs-lookup"><span data-stu-id="7e377-391">**Security** should be a major focus point throughout the entire lifecycle of a solution, from design and implementation to deployment and operations.</span></span> <span data-ttu-id="7e377-392">身分識別、保護您的基礎結構、應用程式安全性、授權、資料主權和加密、稽核都是需要解決的廣泛領域。</span><span class="sxs-lookup"><span data-stu-id="7e377-392">Identity management, protecting your infrastructure, application security, authorization, data sovereignty and encryption, auditing are all broad areas that need to be addressed.</span></span>

## <a name="posq-converting-the-data-to-a-stream"></a><span data-ttu-id="7e377-393">PoSQ：將資料轉換至串流</span><span class="sxs-lookup"><span data-stu-id="7e377-393">PoSQ: Converting the data to a stream</span></span>

<span data-ttu-id="7e377-394">**延展性**：我們可以從兩個層面來達到延展性。</span><span class="sxs-lookup"><span data-stu-id="7e377-394">**Scalability**: We can approach the scalability from two perspectives.</span></span> <span data-ttu-id="7e377-395">首先，從元件的觀點來看，第二，從提供來源資料的系統觀點來看。</span><span class="sxs-lookup"><span data-stu-id="7e377-395">First, from the perspective of the component, second, from the perspective of the system that provides the source data.</span></span>

<span data-ttu-id="7e377-396">每個 Azure 服務皆提供垂直和水平縮放的選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-396">Each Azure service provides options for vertical and horizontal scaling.</span></span> <span data-ttu-id="7e377-397">我們強烈建議在設計解決方案時考量延展性需求。</span><span class="sxs-lookup"><span data-stu-id="7e377-397">We strongly recommend considering the scalability requirements while designing the solution.</span></span>

<span data-ttu-id="7e377-398">至於提供來源資料的系統，需注意不要對系統造成衝擊，過於頻繁地查詢系統，基本上會導致系統的拒絕服務 (DoS) 攻擊。</span><span class="sxs-lookup"><span data-stu-id="7e377-398">As for the systems providing the source data, we need to be careful about not to overwhelm the system, and basically causing a denial of service (DoS) attack on the system, by querying it too frequently.</span></span> <span data-ttu-id="7e377-399">如果要輪詢系統，應該記住調整輪詢頻率有兩個影響，即資料的粒度 (查詢次數越多，越接近即時)，以及遠端系統上建立的負載。</span><span class="sxs-lookup"><span data-stu-id="7e377-399">If you are polling the system, you should keep in mind that adjusting the polling frequency has two effects, the granularity of the data (the more often you query, the closer it gets to real-time) and the load created on the remote system.</span></span> 

<span data-ttu-id="7e377-400">**安全性**：如果藉由對稱或非對稱金鑰存取遠端系統，建議將密碼保存在 [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/?WT.mc_id=iotinsightssoln-docs-ercenk) 中。</span><span class="sxs-lookup"><span data-stu-id="7e377-400">**Security**: If the remote system is accessed by symmetrical or asymmetrical keys, we recommend the secrets to be kept in [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

## <a name="posq-warm-path"></a><span data-ttu-id="7e377-401">PoSQ：經常性路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-401">PoSQ: Warm path</span></span>

<span data-ttu-id="7e377-402">**延展性**：如果 Azure 事件中樞用於擷取子系統，則主要延展性機制為[輸送量單位](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#throughput-units?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-402">**Scalability**: If Azure Event Hubs is the used in the ingestion subsystem, the main scalability mechanism is [throughput units](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#throughput-units?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-403">事件中樞提供以靜態方式或透過[自動擴充功能](https://docs.microsoft.com/azure/event-hubs/event-hubs-auto-inflate?WT.mc_id=iotinsightssoln-docs-ercenk)，設定輸送量單位的功能。</span><span class="sxs-lookup"><span data-stu-id="7e377-403">Event Hubs provide the capability of setting the throughput units statically, or through the [auto-inflate feature](https://docs.microsoft.com/azure/event-hubs/event-hubs-auto-inflate?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="7e377-404">串流分析中的 [串流單位](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-streaming-unit-consumption?WT.mc_id=iotinsightssoln-docs-ercenk) (SU) 代表配置用來執行作業的計算資源。</span><span class="sxs-lookup"><span data-stu-id="7e377-404">[Streaming Units](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-streaming-unit-consumption?WT.mc_id=iotinsightssoln-docs-ercenk) (SUs) in Stream Analytics represent the computing resources that are allocated to execute a job.</span></span> <span data-ttu-id="7e377-405">SU 的數目愈大，為您的作業配置的 CPU 和記憶體資源就愈多。</span><span class="sxs-lookup"><span data-stu-id="7e377-405">The higher the number of SUs, the more CPU and memory resources are allocated for your job.</span></span> <span data-ttu-id="7e377-406">這個容量可讓您專注於查詢邏輯，並以及時的方式摘要出管理硬體以執行串流分析作業的需求。</span><span class="sxs-lookup"><span data-stu-id="7e377-406">This capacity lets you focus on the query logic and abstracts the need to manage the hardware to run your Stream Analytics job in a timely manner.</span></span> <span data-ttu-id="7e377-407">除了 SU 以外，透過[正確地平行處理查詢](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-scale-jobs?WT.mc_id=iotinsightssoln-docs-ercenk)以有效運用非常重要。</span><span class="sxs-lookup"><span data-stu-id="7e377-407">In addition to SUs, making efficient use of them through [properly parallelizing the queries](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-scale-jobs?WT.mc_id=iotinsightssoln-docs-ercenk) is crucial.</span></span>

<span data-ttu-id="7e377-408">Azure Cosmos DB 實作需要佈建正確的輸送量參數和適當的資料分割設計。</span><span class="sxs-lookup"><span data-stu-id="7e377-408">Azure Cosmos DB implementations need to be provisioned with the right throughput parameters and proper partitioning design.</span></span> <span data-ttu-id="7e377-409">可以在容器或資料庫層級佈建輸送量，並以[要求單位](https://docs.microsoft.com/azure/cosmos-db/request-units?WT.mc_id=iotinsightssoln-docs-ercenk) (RU) 表示。</span><span class="sxs-lookup"><span data-stu-id="7e377-409">Provisioning the throughput is available at the container or the data base level, and expressed in [Request Units](https://docs.microsoft.com/azure/cosmos-db/request-units?WT.mc_id=iotinsightssoln-docs-ercenk) (RUs).</span></span> <span data-ttu-id="7e377-410">Cosmos DB 提供估算要求單位的工具。</span><span class="sxs-lookup"><span data-stu-id="7e377-410">Cosmos DB provides a tool for estimating the RUs.</span></span> <span data-ttu-id="7e377-411">除了佈建輸送量以外，[有效分割資料庫](https://docs.microsoft.com/azure/cosmos-db/partition-data?WT.mc_id=iotinsightssoln-docs-ercenk)至關重要。</span><span class="sxs-lookup"><span data-stu-id="7e377-411">In addition to provisioning the throughput, [efficiently partitioning the database](https://docs.microsoft.com/azure/cosmos-db/partition-data?WT.mc_id=iotinsightssoln-docs-ercenk) is key.</span></span>

<span data-ttu-id="7e377-412">**安全性**：用戶端對 Azure 事件中樞的存取權是透過共用存取簽章 (SAS) 權杖和事件發行者組合，進行用戶端身份驗證。</span><span class="sxs-lookup"><span data-stu-id="7e377-412">**Security**: Access to Azure Event Hubs by clients is through a combination of Shared Access Signature (SAS) tokens and event publishers for client authentication.</span></span> <span data-ttu-id="7e377-413">後端應用程式的安全性遵循與服務匯流排主題相同的概念。</span><span class="sxs-lookup"><span data-stu-id="7e377-413">The security for back-end applications follow the same concepts as the Service Bus topics.</span></span> <span data-ttu-id="7e377-414">有關事件中樞安全性模型的詳細說明，請參閱[事件中樞驗證和安全性模型概觀](https://docs.microsoft.com/azure/event-hubs/event-hubs-authentication-and-security-model-overview?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-414">A thorough description of the Event Hubs security model is in the [Event Hubs authentication and security model overview](https://docs.microsoft.com/azure/event-hubs/event-hubs-authentication-and-security-model-overview?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="7e377-415">保護 Cosmos DB 資料庫可以提供對資料的受控存取權，以及加密待用資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-415">Securing the Cosmos DB databases provides controlled access to the data, and encryption at rest.</span></span> <span data-ttu-id="7e377-416">如需詳細資訊，請參閱 [Azure Cosmos DB 資料庫安全性](https://docs.microsoft.com/azure/cosmos-db/database-security?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-416">For more information, see [Azure Cosmos DB database security](https://docs.microsoft.com/azure/cosmos-db/database-security?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="7e377-417">**成本效益**：事件中樞的價格是 SKU (標準或進階) 的函式，以及收到的數百萬個事件，加上輸送量單位。</span><span class="sxs-lookup"><span data-stu-id="7e377-417">**Cost Efficiency**: The pricing of Event Hubs is a function of the SKU (standard or premium), and the millions of events received, plus throughput units.</span></span> <span data-ttu-id="7e377-418">藉由查看由傳入訊息指示的資料擷取率，可以實現最佳組合。</span><span class="sxs-lookup"><span data-stu-id="7e377-418">The optimum combination can be achieved by looking at the data ingest rate that is dictated by the incoming messages.</span></span>

<span data-ttu-id="7e377-419">使用 Cosmos DB 時，建議透過 RU 使用率，觀察存放區的最佳使用情況。</span><span class="sxs-lookup"><span data-stu-id="7e377-419">When using Cosmos DB, we recommend observing the most optimum use of the store through the RU utilization.</span></span> <span data-ttu-id="7e377-420">Cosmos DB 也有控制資料保留的功能，如先前所述，建議使用該功能來控制記錄存留在資料庫中的時間，進而控制資料庫的大小。</span><span class="sxs-lookup"><span data-stu-id="7e377-420">Cosmos DB also has a feature for controlling data retention, as we stated earlier, we recommend using the feature to control the time the records stay in the database, thus controlling the database size.</span></span>

## <a name="posq-cold-path"></a><span data-ttu-id="7e377-421">PoSQ：非經常性路徑</span><span class="sxs-lookup"><span data-stu-id="7e377-421">PoSQ: Cold path</span></span>

<span data-ttu-id="7e377-422">**延展性**Azure 時間序列深入解析 (TSI) 使用名為「容量」的計量進行調整，該計量是套用至輸入速率、儲存體容量，以及與 SKU 相關之成本的乘數。</span><span class="sxs-lookup"><span data-stu-id="7e377-422">**Scalability**: Azure Time Series Insights (TSI) is scaled with a metric named as “capacity” which is a multiplier applied to the ingress rate, storage capacity and the cost associated with the SKU.</span></span> 

<span data-ttu-id="7e377-423">Azure 時間序列深入解析有多個 SKU，這些 SKU 對其垂直調整也有直接影響。</span><span class="sxs-lookup"><span data-stu-id="7e377-423">Azure Time Series Insights has multiple SKUs that also have direct effect on its vertical scale.</span></span> <span data-ttu-id="7e377-424">如需調整的相關詳細資料，請參閱文件[規劃 Azure 時間序列深入解析環境](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-environment-planning?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-424">See the document [Plan your Azure Time Series Insights environment](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-environment-planning?WT.mc_id=iotinsightssoln-docs-ercenk) for details on scale.</span></span> <span data-ttu-id="7e377-425">如同其他許多 Azure 服務一樣，TSI 也受限於節流，以避免「吵雜芳鄰」問題。</span><span class="sxs-lookup"><span data-stu-id="7e377-425">Like many other Azure services, TSI is also subject to throttling to avoid the “noisy neighbor” problem.</span></span> <span data-ttu-id="7e377-426">吵雜的芳鄰是在共用環境 https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-vcore?WT.mc_id=iotinsightssoln-docs-ercenk 中的應用程式，它獨占資源，並讓其他使用者無資源可用。</span><span class="sxs-lookup"><span data-stu-id="7e377-426">A noisy neighbor is an application on a shared environment https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-vcore?WT.mc_id=iotinsightssoln-docs-ercenk that monopolizes the resources and starves the other users.</span></span> <span data-ttu-id="7e377-427">如需管理節流的詳細資訊，請參閱 [TSI 說明文件](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-environment-mitigate-latency?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-427">Please see the [TSI documentation](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-environment-mitigate-latency?WT.mc_id=iotinsightssoln-docs-ercenk) for managing the throttling.</span></span> 

<span data-ttu-id="7e377-428">儲存體帳戶的延展性目標記錄在 [Azure 儲存體延展性和效能目標](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets?WT.mc_id=iotinsightssoln-docs-ercenk)中。</span><span class="sxs-lookup"><span data-stu-id="7e377-428">Scalability targets of storage accounts are documented in [Azure Storage Scalability and Performance Targets](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="7e377-429">儲存資料超出單一儲存帳戶容量的常用技術是，跨多個儲存體帳戶進行分割。</span><span class="sxs-lookup"><span data-stu-id="7e377-429">A common technique for storing data beyond the capacity of a single storage account is partitioning across multiple storage accounts.</span></span>

<span data-ttu-id="7e377-430">Azure SQL Database 有許多選項可垂直和水平管理延展性，取決於購買模型 ([以 DTU 為基礎](https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-dtu?WT.mc_id=iotinsightssoln-docs-ercenk)和以虛擬核心為基礎)。</span><span class="sxs-lookup"><span data-stu-id="7e377-430">Azure SQL Database has many options to manage scalability, both vertically and horizontally, depending on the purchasing model ([DTU based](https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-dtu?WT.mc_id=iotinsightssoln-docs-ercenk) and vCore based).</span></span> <span data-ttu-id="7e377-431">我們建議進一步研究，以使用關於該主題的 [SQL Database 說明文件](https://docs.microsoft.com/azure/sql-database/sql-database-scale-resources?WT.mc_id=iotinsightssoln-docs-ercenk)，找出未來解決方案的最佳選項。</span><span class="sxs-lookup"><span data-stu-id="7e377-431">We recommend further research to find the best option for a future solution using the [SQL Database documentation](https://docs.microsoft.com/azure/sql-database/sql-database-scale-resources?WT.mc_id=iotinsightssoln-docs-ercenk) on the topic.</span></span>

<span data-ttu-id="7e377-432">**安全性**：TSI 環境為彼此獨立的管理存取和資料存取提供[存取原則](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-data-access?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-432">**Security**: TSI environments provide [access policies](https://docs.microsoft.com/azure/time-series-insights/time-series-insights-data-access?WT.mc_id=iotinsightssoln-docs-ercenk) for management access and data access independent of each other.</span></span> <span data-ttu-id="7e377-433">除了定義的資料來源以外，沒有直接的方法可將資料新增到 TSI 環境。</span><span class="sxs-lookup"><span data-stu-id="7e377-433">There is no direct way to add data to a TSI environment other than the defined data sources.</span></span> <span data-ttu-id="7e377-434">管理存取原則可授與環境設定相關權限。</span><span class="sxs-lookup"><span data-stu-id="7e377-434">Management access policies grant permissions related to the configuration of the environment.</span></span> <span data-ttu-id="7e377-435">資料存取原則可授與下列權限：發出資料查詢、在環境中操作參考資料，以及共用與環境相關聯的已儲存查詢和檢視方塊。</span><span class="sxs-lookup"><span data-stu-id="7e377-435">Data access policies grant permissions to issue data queries, manipulate reference data in the environment, and share saved queries and perspectives associated with the environment.</span></span>

<span data-ttu-id="7e377-436">Azure Data Factory 服務提供多種方法來保護資料存放區認證，無論是在其受管存放區中，或在 Azure Key Vault 中。</span><span class="sxs-lookup"><span data-stu-id="7e377-436">Azure Data Factory service provides multiple methods for securing data store credentials, either in its managed store, or in Azure Key Vault.</span></span> <span data-ttu-id="7e377-437">傳輸中資料加密取決於資料存放區的傳輸 (例如 HTTPS 或 TLS)。</span><span class="sxs-lookup"><span data-stu-id="7e377-437">In-transit data encryption depends on the data store’s transport (e.g. HTTPS or TLS).</span></span> <span data-ttu-id="7e377-438">待用資料加密也取決於資料存放區。</span><span class="sxs-lookup"><span data-stu-id="7e377-438">At-rest data encryption also depends on the data stores.</span></span> <span data-ttu-id="7e377-439">如需進一步的詳細資料，請參閱[在 Azure Data Factory 中資料移動的安全性考量](https://docs.microsoft.com/azure/data-factory/data-movement-security-considerations?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-439">See [Security considerations for data movement in Azure Data Factory](https://docs.microsoft.com/azure/data-factory/data-movement-security-considerations?WT.mc_id=iotinsightssoln-docs-ercenk) for further details.</span></span>

<span data-ttu-id="7e377-440">SQL Database 提供一套廣泛的安全性功能，用於資料存取、監視，以及加密待用資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-440">SQL Database provides an extensive set of security features for data access, monitoring and auditing as well as encrypting data at rest.</span></span> <span data-ttu-id="7e377-441">如需詳細資料，請參閱 [SQL Server Database Engine 和 Azure SQL Database 的資訊安全中心](https://docs.microsoft.com/sql/relational-databases/security/security-center-for-sql-server-database-engine-and-azure-sql-database?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="7e377-441">For details, see [Security Center for SQL Server Database Engine and Azure SQL Database](https://docs.microsoft.com/sql/relational-databases/security/security-center-for-sql-server-database-engine-and-azure-sql-database?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="7e377-442">**成本效益**：任何分析解決方案的核心都是儲存體。</span><span class="sxs-lookup"><span data-stu-id="7e377-442">**Cost Efficiency**: At the heart of any analytics solution is the storage.</span></span> <span data-ttu-id="7e377-443">分析引擎需要速度、效率、安全性和輸送量，以便在合理的時間內處理大量資料。</span><span class="sxs-lookup"><span data-stu-id="7e377-443">Analytics engines need speed, efficiency, security, and throughput for processing volumes of data in reasonable times.</span></span> <span data-ttu-id="7e377-444">藉由彙總和摘錄資料，並有效地使用多語言存放區，制定充分利用基礎平台的機制，是有效管理成本的方法。</span><span class="sxs-lookup"><span data-stu-id="7e377-444">Devising mechanisms to make best of use of the underlying platform, by aggregating and summarizing data, and efficiently using polyglot stores are the means for efficiently managing costs.</span></span> <span data-ttu-id="7e377-445">由於 Azure 是雲端平台，因此，有一些方法可利用程式設計的方式來解除委任、重新委任，以及調整資源大小。</span><span class="sxs-lookup"><span data-stu-id="7e377-445">As Azure is a cloud platform, there are methods to programmatically decommission, recommission, and resize resources.</span></span> <span data-ttu-id="7e377-446">例如，[建立或更新作業](https://docs.microsoft.com/rest/api/sql/databases/createorupdate?WT.mc_id=iotinsightssoln-docs-ercenk)可用於變更 Azure SQL Database 的資料庫大小。</span><span class="sxs-lookup"><span data-stu-id="7e377-446">For example, the [Create or Update operation](https://docs.microsoft.com/rest/api/sql/databases/createorupdate?WT.mc_id=iotinsightssoln-docs-ercenk) provides a way to change the database size of Azure SQL Database.</span></span>